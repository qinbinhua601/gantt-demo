(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();const H={};H.show=function(){if(!H.el){const t=document.querySelector(".popup-wrapper"),o=document.querySelector(".popup-wrapper__body"),s=t.querySelector("button.modify"),a=t.querySelector("button.delete"),e=t.querySelector("button.copy");t.addEventListener("click",function(){H.hide()}),s.onclick=function(n){n.preventDefault();const r=this.parentElement.previousElementSibling.value,u=Number(this.parentElement.previousElementSibling.dataset.index);tasks.splice(u,1,JSON.parse(r)),syncLocal(),H.hide(),redrawChart(!0)},a.onclick=function(n){n.preventDefault();const r=Number(this.parentElement.previousElementSibling.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(r,1),syncLocal()),H.hide(),redrawChart(!0)},e.onclick=function(n){n.preventDefault();const r=Number(this.parentElement.previousElementSibling.dataset.index),u={...tasks[r],duration:1};tasks.splice(r+1,0,u),console.log(tasks[r]),syncLocal(),H.hide(),redrawChart(!0)},o.onclick=function(n){n.stopPropagation()},H.el=t}H.el.style.display="flex"};H.hide=function(){H.el.style.display="none"};function yt(t,o,s){if(t&&t.length){const[a,e]=o,n=Math.PI/180*s,r=Math.cos(n),u=Math.sin(n);for(const y of t){const[i,l]=y;y[0]=(i-a)*r-(l-e)*u+a,y[1]=(i-a)*u+(l-e)*r+e}}}function Dt(t,o,s){const a=[];t.forEach(e=>a.push(...e)),yt(a,o,s)}function Pt(t,o){return t[0]===o[0]&&t[1]===o[1]}function kt(t,o,s,a=1){const e=s,n=Math.max(o,.1),r=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,u=[0,0];if(e)for(const i of r)yt(i,u,e);const y=Nt(r,n,a);if(e){for(const i of r)yt(i,u,-e);Dt(y,u,-e)}return y}function Nt(t,o,s){const a=[];for(const i of t){const l=[...i];Pt(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&a.push(l)}const e=[];o=Math.max(o,.1);const n=[];for(const i of a)for(let l=0;l<i.length-1;l++){const h=i[l],k=i[l+1];if(h[1]!==k[1]){const L=Math.min(h[1],k[1]);n.push({ymin:L,ymax:Math.max(h[1],k[1]),x:L===h[1]?h[0]:k[0],islope:(k[0]-h[0])/(k[1]-h[1])})}}if(n.sort((i,l)=>i.ymin<l.ymin?-1:i.ymin>l.ymin?1:i.x<l.x?-1:i.x>l.x?1:i.ymax===l.ymax?0:(i.ymax-l.ymax)/Math.abs(i.ymax-l.ymax)),!n.length)return e;let r=[],u=n[0].ymin,y=0;for(;r.length||n.length;){if(n.length){let i=-1;for(let h=0;h<n.length&&!(n[h].ymin>u);h++)i=h;n.splice(0,i+1).forEach(h=>{r.push({s:u,edge:h})})}if(r=r.filter(i=>!(i.edge.ymax<=u)),r.sort((i,l)=>i.edge.x===l.edge.x?0:(i.edge.x-l.edge.x)/Math.abs(i.edge.x-l.edge.x)),(s!==1||y%o===0)&&r.length>1)for(let i=0;i<r.length;i=i+2){const l=i+1;if(l>=r.length)break;const h=r[i].edge,k=r[l].edge;e.push([[Math.round(h.x),u],[Math.round(k.x),u]])}u+=s,r.forEach(i=>{i.edge.x=i.edge.x+s*i.edge.islope}),y++}return e}window.hachureLines=kt;const vt={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"}};function Lt(t){const o=new Date(t),s=o.getMonth()+1+"",a=s.padStart(2,"0"),e=o.getDate()+"",n=e.padStart(2,"0"),r=`${a}-${n}`,u=[0,6].indexOf(o.getDay())!=-1;return vt[r]?{isHoliday:vt[r].holiday,dateString:`${s}-${e}`}:{isHoliday:u,dateString:`${s}-${e}`}}function z(t="unitWidth",o=!0){const s=new URLSearchParams(location.search);return s.get(t)&&o?Number(s.get(t)):s.get(t)}function D(){Q||It()||z("useLocal")&&Object.keys(it).forEach(t=>{const o=localStorage.getItem(t);try{localStorage.setItem(t,JSON.stringify(window[t]))}catch{console.error("fail to syncLocal"),localStorage.setItem(t,o)}})}window.syncLocal=D;let ft=null;function It(){if(z("useRemote")){const t={tasks:window.tasks,mileStones:window.mileStones};return ft&&clearTimeout(ft),ft=setTimeout(()=>{Mt(t).then(o=>{o.status===0&&console.log("recordUpdate成功",o)})},200),!0}return!1}const bt=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Mt(t){return fetch(`${bt}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:st,...t})}).then(o=>o.json())}function Ft(){return console.log("current view",st),fetch(`${bt}/record/query${st?`?view=${st}`:""}`).then(t=>t.json())}const it={tasks:[{}],mileStones:[]};function Tt(t="tasks"){try{return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):it[t]}catch{return console.error("fail to getLocal"),it[t]}}function j(){const t=Math.floor(Math.random()*256),o=Math.floor(Math.random()*256),s=Math.floor(Math.random()*256);return"#"+t.toString(16).padStart(2,"0")+o.toString(16).padStart(2,"0")+s.toString(16).padStart(2,"0")}function Ot(t,o){t.dom.style.opacity=0,Ft().then(s=>{const{data:a}=s;console.log(a),a!=null&&a.tasks||a!=null&&a.mileStones?(wt("tasks",a.tasks.filter(e=>Q?e.fillColor===Q:!0)),wt("mileStones",a.mileStones)):a||window.tasks.push({}),Et(a==null?void 0:a.tasks),o(!0),t.dom.style.opacity=1})}function qt(t){const o=t?{view:`${t}`}:{};Mt({tasks:window.tasks,mileStones:window.mileStones,...o})}window.saveToRemote=qt;function Wt(t){Object.keys(it).forEach(o=>{const s=localStorage.getItem(o);try{localStorage.setItem(o,JSON.stringify(window[o]))}catch{console.error("fail to syncLocal"),localStorage.setItem(o,s)}})}window.saveToLocal=Wt;function wt(t,o){window[`old_${t}`]=[...window[t]],window[t].length=0,window[t].push(...o)}function zt(t){var s;console.log(t.target);const o=new URLSearchParams(location.search);(s=t.target.dataset)!=null&&s.color?(t.target.dataset.hovered=!0,o.set("filter",t.target.dataset.color)):o.delete("filter"),location.href=`${location.pathname}?${o.toString()}`}function Et(t){if(!dt&&!pt||!Bt||!t)return;const o=t,s=document.querySelector("#color-picker");s.removeEventListener("click",zt),s.addEventListener("click",zt);const a=[...new Set(o.map(({fillColor:e})=>e)),""].filter(e=>e!==void 0).map(e=>`<div data-color="${e}" style="background-color: ${e};"></div>`);s.innerHTML=a.join("")}let N=null;const _=t=>{N=t},ct=z("debug")??!1,At="alexq",c=z()??160,q=c/2,at=z("taskNamePaddingLeft")??15,jt=1,_t=50,M=z("timeScaleHeight")??20,V=z("milestoneTopHeight")??20,f=z("barHeight")??30,p=ct?10:z("barMargin")??1,Jt=z("scrollSpeed")??35,Yt=z("includeHoliday")??!1,dt=z("useLocal"),pt=z("useRemote"),st=z("view",!1)??"",Gt=!pt&&!dt&&z("mockTaskSize")?Number(z("mockTaskSize")):0,Rt=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),lt=(Rt-1)*c,ut=document.querySelector("#last-scroll-x");ut.innerText=lt;const Q=z("filter",!1)??null,Bt=z("showFilter")??!1;function Ut(t,o,s,a){const e=document.querySelector("#back-to-origin-button");e==null||e.addEventListener("click",function(){t(lt),o(0),s.innerText=lt,a(!0)});const n=document.querySelector("#clear-button");n==null||n.addEventListener("click",function(){const u=tasks.length;tasks.length=0;for(let y=0;y<u;y++)tasks.push({});D(),a(!0)});const r=document.querySelector("#clear-milestone-button");r==null||r.addEventListener("click",function(){mileStones.length=0,D(),a(!0)}),Bt&&Et(window.tasks)}function Vt(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function Kt(t,o,s,a,e){const n=new zrender.Group,r=Vt(),{width:u,height:y}=r.getBoundingRect();r.attr({x:o+s-u/2,y:a-e+e/2-y/2});const i=new zrender.Circle({shape:{cx:o+s+1,cy:a-e+e/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return n.add(i),n.add(r),n.hide(),t.add(n),[n,{flag:r,flagHoveredCircle:i}]}function Qt(t,o,s,a){const{height:e,width:n}=s,r=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${ct?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:o.x,y:o.y,shape:{x:-t/2,y:0}});let u=0,y=0,i=0;return r.on("dragstart",function(l){this.parent.resizing=!0,u=l.event.zrX;const h=this.taskBar;i=h.shape.width,y=h.shape.x,_(this.parent)}),r.on("drag",function(l){const h=l.event.zrX-u;this.taskBar.attr({shape:{x:y+h,width:i-h}})}),r.on("dragend",function(l){const h=l.event.zrX-u,k=h<0?-1:1,L=Math.abs(h),W=L%c,P=k*(Math.floor(L/c)+Math.floor(W/q));console.log(P);const Z=tasks[this.parent.index];Z.start+=P,Z.duration-=P,P&&D(),_(null),a(!0)}),r}function Zt(t,o,s,a){const{height:e,width:n}=s,r=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${ct?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:o.x+n,y:o.y,shape:{x:-t/2,y:0}});let u=0,y=0;return r.on("dragstart",function(i){this.parent.resizing=!0,u=i.event.zrX;const l=this.taskBar;y=l.shape.width,l.shape.x,console.log(N),_(this.parent)}),r.on("drag",function(i){const l=i.event.zrX-u;this.taskBar.attr({shape:{width:y+l}})}),r.on("dragend",function(i){const l=i.event.zrX-u,h=l<0?-1:1,k=Math.abs(l),L=k%c,W=h*(Math.floor(k/c)+Math.floor(L/q)),P=tasks[this.parent.index];P.duration+=W,W&&D(),_(null),a(!0)}),r}const te=+new Date("2024-01-01"),ee=60*60*24*1e3;function ne(t,o){const{start:s,duration:a}=t;if(o)return t.duration;let e=0;const n=a+s;for(let r=s;r<n;r++)Lt(new Date(te+ee*r)).isHoliday||e++;return e}function oe(t,o,s,a,e){return e<0||e>tasks.length-1?null:new zrender.Rect({shape:{x:t+s,y:o+(f+p)*e,width:a*c,height:1},style:{fill:"blue"},zlevel:1})}function re(t,o,s,a,e,n,r){const u=new zrender.Rect({shape:{x:o+r*c-1+q,y:s,width:2,height:tasks.length*(e+n)},style:{fill:"#2955c9"},z:1}),y=new zrender.Circle({shape:{cx:o+r*c+q,cy:s-a+a+2,r:3},style:{fill:"#2955c9"}});t.add(u),t.add(y)}let gt=null,E=0+lt;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),x=dt?Tt():[{name:"Task 1",start:0,duration:3,resource:"John",fillColor:j()},{name:"Task 2",start:2,duration:4,resource:"Jane",fillColor:j()},{name:"Task 3 long long long",start:7,duration:1,resource:"Bob",fillColor:j()},{name:"Task 4",start:8,duration:2,resource:"Bose",fillColor:j()},{name:"Task 5",start:10,duration:3,resource:"Uno",fillColor:j()},{}],ae=x.pop();for(;x.length>1&&x.length<Gt;)x.push(...x.map(t=>({...t})));x.push(ae);window.tasks=x;const K=dt?Tt("mileStones"):[{start:10,name:"提测"}];window.mileStones=K;m.on("mousewheel",function(t){t.event.preventDefault(),E-=Math.floor(t.event.wheelDeltaX*.01*Jt),R(!0,E,0),ut.innerText=E});window.addEventListener("resize",function(){m.resize(),R(!0)});Ut(t=>E=t,t=>t,ut,R);let mt=!0;function R(t=!1,o=E,s=0){const a=mt;mt&&(mt=!1);const e=jt-o,n=Math.max(_t,M+V)-s;t&&m.clear();const r=m.getWidth(),u=m.getHeight(),y=Math.floor(E/c),i=Math.floor((E+r)/c);let l,h;function k(d){if(N!=null&&N.resizing||N!=null&&N.dragging)return;const v=d.event.zrX-e,T=d.event.zrY-n,S=Math.floor(v/c),g=Math.floor(T/(f+p));if(l!==[S,g].join())if(l=[S,g].join(),g>=0&&g<x.length){if(S>=x[g].start&&S<x[g].start+x[g].duration){h&&m.remove(h);return}const w=new zrender.Group;w.on("click",function(){console.log("dayHoverGroup clicked pos: ",[S,g]);const F=prompt("task name?");if(!F)return;const O=prompt("assign to who?")||At;x.splice(g,0,{name:F,start:S,duration:1,resource:O,fillColor:j()}),D(),R(!0)});const B=new zrender.Rect({shape:{x:e+c*S+5,y:n+(f+p)*g,width:c-10,height:f+p},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),C=new zrender.Rect({shape:{x:e+E,y:n+(f+p)*g,width:c*L,height:f+p},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),I=new zrender.Line({shape:{x1:e+c*S+c/2-5,y1:n+(f+p)*g+(f+p)/2,x2:e+c*S+c/2+5,y2:n+(f+p)*g+(f+p)/2},style:{stroke:"gray"},z:100}),J=new zrender.Line({shape:{x1:e+c*S+c/2,y1:n+(f+p)*g+(f+p)/2-5,x2:e+c*S+c/2,y2:n+(f+p)*g+(f+p)/2+5},style:{stroke:"gray"},z:100});w.add(B),w.add(I),w.add(J),w.add(C),h&&m.remove(h),h=w,m.add(w)}else h&&m.remove(h)}gt&&m.off("mousemove",gt),gt=k,m.on("mousemove",k);const L=Math.ceil(r/c),W=new zrender.Rect({shape:{x:e+E,y:n-M,width:L*c,height:M},style:{fill:"rgba(255, 0,0, .2)"}});m.add(W);const P=e,Z=L*c,xt=L+1,Ct=Math.floor(E/c);for(let d=0+Ct,v=0;v<xt;d++,v++){const T=Math.min(x.length,(u-n)/(f+p)),S=P+d*c,g=new zrender.Line({shape:{x1:S,y1:n-M,x2:S,y2:n+(f+p)*T},style:{stroke:"lightgray"}});if(v<xt-1){const w=+new Date("2024-01-01")+d*60*1e3*60*24,B=Lt(w);if(B.isHoliday)try{kt([[e+d*c,n],[e+d*c+c,n],[e+d*c+c,n+(f+p)*T],[e+d*c,n+(f+p)*T]],10,45).forEach($=>{const[et,nt]=$[0],[ot,Y]=$[1],b=new zrender.Line({shape:{x1:et,y1:nt,x2:ot,y2:Y},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(b)})}catch(X){console.log(X)}const C=new zrender.Text({style:{text:B.dateString,x:S,y:n-M},z:1}),[I,{flag:J}]=Kt(m,S,q,n,M);C.on("click",function(){console.log("date text click",d);const X=K.findIndex($=>$.start===d);if(X===-1){if(confirm("Do you want to CREATE a milestone here?")){const $=prompt("mileStone name?");K.push({start:d,name:$}),D()}}else confirm("Do you want to DELETE the milestone here?")&&(K.splice(X,1),D());R(!0)}),C.on("mouseover",function(X){this.attr({style:{opacity:0}}),I.show()}),C.on("mouseout",function(X){this.attr({style:{opacity:1}}),I.hide()});const{width:F,height:O}=C.getBoundingRect();C.attr({style:{x:S-F/2+q,y:n-M-O/2+M/2}}),m.add(C)}m.add(g)}x.length+1;for(let d=0;d<1;d++){const v=n+d*(f+p),T=new zrender.Line({shape:{x1:e,y1:v,x2:Z+e,y2:v},style:{stroke:"lightgray"}});m.add(T)}re(m,e,n,M,f,p,Rt),K.forEach(function(d){const v=new zrender.Rect({shape:{x:e+d.start*c-1,y:n-M,width:2,height:x.length*(f+p)+M},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),T=new zrender.Rect({shape:{x:e+d.start*c-1,y:n-M-V,width:10,height:V},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),S=new zrender.Text({style:{x:e+d.start*c-1+10,y:n-M-V,text:d.name||"里程碑",fill:"white",lineHeight:V,fontSize:12},z:1}),g=S.getBoundingRect();T.attr({shape:{width:g.width+10*2}}),m.add(v),m.add(T),m.add(S)});let ht=0;x.forEach(function(d,v){if(!(d!=null&&d.name)||v>Math.floor((u-n)/(f+p))||d.start>i||d.start+d.duration<y)return;ht++;const T=e+d.start*c,S=n+(f+p)*v,g=d.duration*c,tt={width:g,height:f},w=new zrender.Group({x:T,y:S,draggable:!0}),B=new zrender.Rect({shape:{x:0,y:0,width:g,height:f,r:6},style:{fill:d.fillColor},cursor:"move"});w.add(B),w.index=v;const C=6,I=B.getBoundingRect(),J=Qt(C,I,tt,R);J.taskBar=B,w.add(J);const F=Zt(C,I,tt,R);F.taskBar=B,w.add(F),w.on("mouseover",function(){this.dragging||B.attr("style",{fill:zrender.color.lift(d.fillColor,.3)})}),w.on("mouseout",function(){this.dragging||this.resizing||B.attr("style",{fill:d.fillColor})});const O=new zrender.Text({style:{text:d.name,x:at,y:f/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),X=new zrender.Text({style:{text:`${ne(d,Yt)}天`,x:g-at,y:f/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:$}=X.getBoundingRect();X.attr({style:{x:g-$-at}});const et=new zrender.Text({style:{text:"Assigned to: "+d.resource,x:0+g+5,y:f/2+0-12/2,textFill:"black"},cursor:"normal"});O.getBoundingRect().width+$+at*2>g&&(et.attr({style:{text:d.name}}),O.hide()),w.add(O),w.add(X),w.add(et);let nt=0,ot=null,Y=null;w.on("dragstart",function(b){this.resizing||(nt=b.event.zrX,_(this))}),w.on("drag",function(b){if(this.resizing)return;const rt=b.event.zrY-n,G=Math.floor(rt/(f+p));if(ot!==G){ot=G,m.remove(Y);const A=oe(e,n,E,L,G);Y=A,A&&m.add(A),m.refresh()}}),w.on("dragend",function(b){if(console.log("dragend"),this.resizing){this.resizing=!1;return}const rt=b.event.zrX-nt,G=rt<0?-1:1,A=Math.abs(rt),Xt=A%c,St=G*(Math.floor(A/c)+Math.floor(Xt/q)),Ht=b.event.zrY-n,U=Math.floor(Ht/(f+p)),$t=U-v;d.start+=St,Y&&U!==v&&(x.splice(v,1),x.splice(U>v?U-1:U,0,{...d})),(St||$t)&&D(),_(null),R(!0)}),w.eachChild(function(b){b.attr({z:10})}),w.on("dblclick",function(){H.show();const b=document.querySelector("#current-task");b.value=JSON.stringify(x[this.index],null,2),b.dataset.index=this.index}),m.add(w)}),a&&ht===0&&x.length>0&&(console.log(x[0].start),E+=(x[0].start-y-1)*c,ut.innerText,R(!0)),ct&&console.log({drawTaskBar:ht})}window.redrawChart=R;pt?(document.title+=" (Remote)",Ot(m,R)):(Q&&wt("tasks",x.filter(t=>t.fillColor===Q)),R());
