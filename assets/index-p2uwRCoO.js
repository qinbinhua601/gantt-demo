(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();function qe(e){let n,o,s=!1;e.addEventListener("mousedown",function(t){e.style.position="absolute",!t.target.closest("#taskForm")&&(s=!0,n=t.clientX-e.getBoundingClientRect().left,o=t.clientY-e.getBoundingClientRect().top,document.body.style.userSelect="none")}),document.addEventListener("mousemove",function(t){if(s){const a=t.clientX-n,r=t.clientY-o;e.style.left=a+"px",e.style.top=r+"px"}}),document.addEventListener("mouseup",function(){s=!1,document.body.style.userSelect="auto"})}const T={};T.show=function({currentIndex:e}){if(!T.el){const t=document.querySelector(".popup-wrapper"),a=document.querySelector(".popup-wrapper__body"),r=t.querySelector("button.modify"),h=document.getElementById("name"),f=document.getElementById("resource"),i=document.getElementById("fillColor");qe(a),t.addEventListener("click",function(){T.hide()}),r.onclick=function(l){l.preventDefault();const d=T.index,w={...tasks[d],name:h.value,resource:f.value,fillColor:i.value};tasks.splice(d,1,w),syncLocal(),T.hide(),redrawChart(!0)},a.onclick=function(l){l.stopPropagation()},T.el=t,T.popupBody=a,T.formItems={name:h,resource:f,fillColor:i}}T.el.style.display="flex",T.index=e;const{name:n,resource:o,fillColor:s}=tasks[e];T.formItems.name.value=n,T.formItems.resource.value=o,T.formItems.fillColor.value=s};T.hide=function(){T.el.style.display="none",T.popupBody.removeAttribute("style")};function ve(e,n,o){if(e&&e.length){const[s,t]=n,a=Math.PI/180*o,r=Math.cos(a),h=Math.sin(a);for(const f of e){const[i,l]=f;f[0]=(i-s)*r-(l-t)*h+s,f[1]=(i-s)*h+(l-t)*r+t}}}function We(e,n,o){const s=[];e.forEach(t=>s.push(...t)),ve(s,n,o)}function je(e,n){return e[0]===n[0]&&e[1]===n[1]}function Xe(e,n,o,s=1){const t=o,a=Math.max(n,.1),r=e[0]&&e[0][0]&&typeof e[0][0]=="number"?[e]:e,h=[0,0];if(t)for(const i of r)ve(i,h,t);const f=_e(r,a,s);if(t){for(const i of r)ve(i,h,-t);We(f,h,-t)}return f}function _e(e,n,o){const s=[];for(const i of e){const l=[...i];je(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&s.push(l)}const t=[];n=Math.max(n,.1);const a=[];for(const i of s)for(let l=0;l<i.length-1;l++){const d=i[l],w=i[l+1];if(d[1]!==w[1]){const C=Math.min(d[1],w[1]);a.push({ymin:C,ymax:Math.max(d[1],w[1]),x:C===d[1]?d[0]:w[0],islope:(w[0]-d[0])/(w[1]-d[1])})}}if(a.sort((i,l)=>i.ymin<l.ymin?-1:i.ymin>l.ymin?1:i.x<l.x?-1:i.x>l.x?1:i.ymax===l.ymax?0:(i.ymax-l.ymax)/Math.abs(i.ymax-l.ymax)),!a.length)return t;let r=[],h=a[0].ymin,f=0;for(;r.length||a.length;){if(a.length){let i=-1;for(let d=0;d<a.length&&!(a[d].ymin>h);d++)i=d;a.splice(0,i+1).forEach(d=>{r.push({s:h,edge:d})})}if(r=r.filter(i=>!(i.edge.ymax<=h)),r.sort((i,l)=>i.edge.x===l.edge.x?0:(i.edge.x-l.edge.x)/Math.abs(i.edge.x-l.edge.x)),(o!==1||f%n===0)&&r.length>1)for(let i=0;i<r.length;i=i+2){const l=i+1;if(l>=r.length)break;const d=r[i].edge,w=r[l].edge;t.push([[Math.round(d.x),h],[Math.round(w.x),h]])}h+=o,r.forEach(i=>{i.edge.x=i.edge.x+o*i.edge.islope}),f++}return t}window.hachureLines=Xe;const Re={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"},"01-01":{holiday:!0,name:"元旦",wage:3,date:"2025-01-01",rest:13},"01-26":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2025-01-26",rest:22},"01-28":{holiday:!0,name:"除夕",wage:2,date:"2025-01-28",rest:24},"01-29":{holiday:!0,name:"初一",wage:3,date:"2025-01-29",rest:1},"01-30":{holiday:!0,name:"初二",wage:3,date:"2025-01-30",rest:1},"01-31":{holiday:!0,name:"初三",wage:3,date:"2025-01-31",rest:1},"02-01":{holiday:!0,name:"初四",wage:2,date:"2025-02-01",rest:1},"02-02":{holiday:!0,name:"初五",wage:2,date:"2025-02-02",rest:1},"02-03":{holiday:!0,name:"初六",wage:2,date:"2025-02-03",rest:1},"02-04":{holiday:!0,name:"初七",wage:2,date:"2025-02-04",rest:1},"02-08":{holiday:!1,name:"春节后补班",wage:1,target:"春节",after:!0,date:"2025-02-08",rest:4},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2025-04-04",rest:16},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2025-04-05",rest:1},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2025-04-06",rest:1},"04-27":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2025-04-27",rest:21},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-01",rest:25},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2025-05-02",rest:1},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-03",rest:1},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-05"},"05-31":{holiday:!0,name:"端午节",wage:3,date:"2025-05-31"},"06-01":{holiday:!0,name:"端午节",wage:2,date:"2025-06-01"},"06-02":{holiday:!0,name:"端午节",wage:2,date:"2025-06-02"},"09-28":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2025-09-28"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2025-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2025-10-02"},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2025-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-05"},"10-06":{holiday:!0,name:"中秋节",wage:2,date:"2025-10-06"},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-07"},"10-08":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-08"},"10-11":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2025-10-11"},"01-01":{holiday:!0,name:"元旦",wage:3,date:"2026-01-01",rest:6},"01-02":{holiday:!0,name:"元旦",wage:2,date:"2026-01-02",rest:1},"01-03":{holiday:!0,name:"元旦",wage:2,date:"2026-01-03",rest:1},"01-04":{holiday:!1,name:"元旦后补班",wage:1,after:!0,target:"元旦",date:"2026-01-04",rest:1},"02-14":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2026-02-14",rest:21},"02-15":{holiday:!0,name:"春节",wage:2,date:"2026-02-15",rest:22},"02-16":{holiday:!0,name:"除夕",wage:3,date:"2026-02-16",rest:1},"02-17":{holiday:!0,name:"初一",wage:3,date:"2026-02-17",rest:1},"02-18":{holiday:!0,name:"初二",wage:3,date:"2026-02-18",rest:1},"02-19":{holiday:!0,name:"初三",wage:3,date:"2026-02-19",rest:1},"02-20":{holiday:!0,name:"初四",wage:2,date:"2026-02-20",rest:1},"02-21":{holiday:!0,name:"初五",wage:2,date:"2026-02-21",rest:1},"02-22":{holiday:!0,name:"初六",wage:2,date:"2026-02-22",rest:1},"02-23":{holiday:!0,name:"初七",wage:2,date:"2026-02-23",rest:1},"02-28":{holiday:!1,name:"春节后补班",wage:1,target:"春节",after:!0,date:"2026-02-28",rest:3},"04-04":{holiday:!0,name:"清明节",wage:2,date:"2026-04-04",rest:34},"04-05":{holiday:!0,name:"清明节",wage:3,date:"2026-04-05",rest:1},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2026-04-06",rest:1},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2026-05-01",rest:25},"05-02":{holiday:!0,name:"劳动节",wage:3,date:"2026-05-02",rest:1},"05-03":{holiday:!0,name:"劳动节",wage:2,date:"2026-05-03",rest:1},"05-04":{holiday:!0,name:"劳动节",wage:2,date:"2026-05-04",rest:1},"05-05":{holiday:!0,name:"劳动节",wage:2,date:"2026-05-05",rest:1},"05-09":{holiday:!1,name:"劳动节后补班",wage:1,after:!0,target:"劳动节",date:"2026-05-09",rest:4},"06-19":{holiday:!0,name:"端午节",wage:3,date:"2026-06-19",rest:45},"06-20":{holiday:!0,name:"端午节",wage:2,date:"2026-06-20",rest:1},"06-21":{holiday:!0,name:"端午节",wage:2,date:"2026-06-21",rest:1},"09-20":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2026-09-20",rest:91},"09-25":{holiday:!0,name:"中秋节",wage:3,date:"2026-09-25",rest:96},"09-26":{holiday:!0,name:"中秋节",wage:2,date:"2026-09-26",rest:1},"09-27":{holiday:!0,name:"中秋节",wage:2,date:"2026-09-27",rest:1},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2026-10-01",rest:4},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2026-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2026-10-03",rest:1},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2026-10-04",rest:1},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2026-10-05",rest:1},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2026-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2026-10-07",rest:1},"10-10":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2026-10-10"}};function Be(e){const n=new Date(e),o=n.getMonth()+1+"",s=o.padStart(2,"0"),t=n.getDate()+"",a=t.padStart(2,"0"),r=`${s}-${a}`,h=[0,6].indexOf(n.getDay())!=-1;return Re[r]?{isHoliday:Re[r].holiday,dateString:`${o}-${t}`}:{isHoliday:h,dateString:`${o}-${t}`}}function b(e="unitWidth",n=!0){const o=new URLSearchParams(location.search);return o.get(e)&&n?Number(o.get(e)):o.get(e)}function Y(){re||Je()||b("useLocal")&&Object.keys(he).forEach(e=>{const n=localStorage.getItem(e);try{localStorage.setItem(e,JSON.stringify(window[e]))}catch{console.error("fail to syncLocal"),localStorage.setItem(e,n)}})}window.syncLocal=Y;let pe=null;function Je(){if(b("useRemote")){const e={tasks:window.tasks,mileStones:window.mileStones};return pe&&clearTimeout(pe),pe=setTimeout(()=>{Ee(e).then(n=>{n.status===0&&console.log("recordUpdate成功",n)})},200),!0}return!1}const Ae=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Ee(e){return fetch(`${Ae}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:ue,...e})}).then(n=>n.json())}function Ue(){return console.log("current view",ue),fetch(`${Ae}/record/query${ue?`?view=${ue}`:""}`).then(e=>e.json())}const he={tasks:[{}],mileStones:[]};function $e(e="tasks"){try{return localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):he[e]}catch{return console.error("fail to getLocal"),he[e]}}function K(){const e=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),o=Math.floor(Math.random()*256);return"#"+e.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")+o.toString(16).padStart(2,"0")}function Ve(e,n){e.dom.style.opacity=0,Ue().then(o=>{const{data:s}=o;console.log(s),s!=null&&s.tasks||s!=null&&s.mileStones?(Se("tasks",s.tasks.filter(t=>re?t.fillColor===re:!0)),Se("mileStones",s.mileStones)):s||window.tasks.push({}),De(s==null?void 0:s.tasks),n(!0),e.dom.style.opacity=1})}function Ze(e){const n=e?{view:`${e}`}:{};Ee({tasks:window.tasks,mileStones:window.mileStones,...n})}window.saveToRemote=Ze;function Ke(e){Object.keys(he).forEach(n=>{const o=localStorage.getItem(n);try{localStorage.setItem(n,JSON.stringify(window[n]))}catch{console.error("fail to syncLocal"),localStorage.setItem(n,o)}})}window.saveToLocal=Ke;function Se(e,n){window[`old_${e}`]=[...window[e]],window[e].length=0,window[e].push(...n)}function Ce(e){var o;console.log(e.target);const n=new URLSearchParams(location.search);(o=e.target.dataset)!=null&&o.color?(e.target.dataset.hovered=!0,n.set("filter",e.target.dataset.color)):n.delete("filter"),location.href=`${location.pathname}?${n.toString()}`}function De(e){if(!me&&!Le||!He||!e)return;const n=e,o=document.querySelector("#color-picker");o.removeEventListener("click",Ce),o.addEventListener("click",Ce);const s=[...new Set(n.map(({fillColor:t})=>t)),""].filter(t=>t!==void 0).map(t=>`<div data-color="${t}" style="background-color: ${t};"></div>`);o.innerHTML=s.join("")}let v=null;const Q=e=>{v=e},ge=b("debug")??!1,Qe="alexq",u=b()??160,_=u/2,ce=b("taskNamePaddingLeft")??15,Ge=1,et=50,B=b("timeScaleHeight")??20,ae=b("milestoneTopHeight")??20,g=b("barHeight")??30,y=ge?10:b("barMargin")??1,tt=b("scrollSpeed")??35,nt=b("includeHoliday")??!1,me=b("useLocal"),Le=b("useRemote"),ue=b("view",!1)??"",at=!Le&&!me&&b("mockTaskSize")?Number(b("mockTaskSize")):0,j=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),fe=(j-1)*u,J=document.querySelector("#last-scroll-x");J.innerText=fe;const re=b("filter",!1)??null,He=b("showFilter")??!1,A=g/3*2,Ie=b("showArrow")??!0,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function ot(e,n,o,s){const t=document.querySelector("#back-to-origin-button");t==null||t.addEventListener("click",function(){e(fe),n(0),o.innerText=fe,s(!0)});const a=document.querySelector("#clear-button");a==null||a.addEventListener("click",function(){const h=tasks.length;tasks.length=0;for(let f=0;f<h;f++)tasks.push({});Y(),s(!0)});const r=document.querySelector("#clear-milestone-button");r==null||r.addEventListener("click",function(){mileStones.length=0,Y(),s(!0)}),He&&De(window.tasks)}function rt(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function st(e,n,o,s,t){const a=new zrender.Group,r=rt(),{width:h,height:f}=r.getBoundingRect();r.attr({x:n+o-h/2,y:s-t+t/2-f/2});const i=new zrender.Circle({shape:{cx:n+o+1,cy:s-t+t/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return a.add(i),a.add(r),a.hide(),e.add(a),[a,{flag:r,flagHoveredCircle:i}]}function it(e,n,o,s){const{height:t,width:a}=o,r=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${ge?1:0})`,lineWidth:1},shape:{width:e,height:t},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:n.x,y:n.y,shape:{x:-e/2,y:0}});let h=0,f=0,i=0;return r.on("dragstart",function(l){this.parent.resizing=!0,h=l.event.zrX;const d=this.taskBar;i=d.shape.width,f=d.shape.x,Q(this.parent)}),r.on("drag",function(l){const d=l.event.zrX-h;this.taskBar.attr({shape:{x:f+d,width:i-d}})}),r.on("dragend",function(l){const d=l.event.zrX-h,w=d<0?-1:1,C=Math.abs(d),$=C%u,N=w*(Math.floor(C/u)+Math.floor($/_));console.log(N);const se=tasks[this.parent.index];se.start+=N,se.duration-=N,N&&Y(),Q(null),s(!0)}),r}function lt(e,n,o,s){const{height:t,width:a}=o,r=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${ge?1:0})`,lineWidth:1},shape:{width:e,height:t},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:n.x+a,y:n.y,shape:{x:-e/2,y:0}});let h=0,f=0;return r.on("dragstart",function(i){this.parent.resizing=!0,h=i.event.zrX;const l=this.taskBar;f=l.shape.width,l.shape.x,console.log(v),Q(this.parent)}),r.on("drag",function(i){const l=i.event.zrX-h;this.taskBar.attr({shape:{width:f+l}})}),r.on("dragend",function(i){const l=i.event.zrX-h,d=l<0?-1:1,w=Math.abs(l),C=w%u,$=d*(Math.floor(w/u)+Math.floor(C/_)),N=tasks[this.parent.index];N.duration+=$,$&&Y(),Q(null),s(!0)}),r}const dt=+new Date("2024-01-01"),ct=60*60*24*1e3;function ut(e,n){const{start:o,duration:s}=e;if(n)return e.duration;let t=0;const a=s+o;for(let r=o;r<a;r++)Be(new Date(dt+ct*r)).isHoliday||t++;return t}function ht(e,n,o,s,t){return t<0||t>tasks.length-1?null:new zrender.Rect({shape:{x:e+o,y:n+(g+y)*t,width:s*u,height:1},style:{fill:"blue"},zlevel:1})}function ft(e,n,o,s,t,a,r){if(!Ie)return;const h=1e3,f=new zrender.Group({x:5,y:n+(s.height-A)/2}),i=new zrender.Text({x:A*.1,style:{text:"←",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:h+1,name:"leftArrowText"});f.add(i);const l=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:h,name:"leftArrowRect"});return f.on("mouseover",function(){a>=o.start+o.duration&&this.childOfName("leftArrowRect").attr({style:{fill:o.fillColor}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),f.on("mouseout",function(){this.childOfName("leftArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),f.on("click",r),f.add(l),t||f.eachChild(function(d){d.hide()}),f}function gt(e,n,o,s,t,a,r,h,f,i){if(!Ie)return;const l=1e3,d=new zrender.Group({x:e+t+a-A-10-o.start*s,y:n+(r.height-A)/2}),w=new zrender.Text({x:A*.1,style:{text:"→",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:l+1,name:"rightArrowText"});d.add(w);const C=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:l,name:"rightArrowRect"});return d.on("mouseover",function(){const $=this.childOfName("rightArrowRect");f<o.start&&$.attr({style:{fill:o.fillColor}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),d.on("mouseout",function(){this.childOfName("rightArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),d.on("click",i),d.add(C),h||d.eachChild(function($){$.hide()}),d}function mt(e,n,o,s,t,a,r){const h=new zrender.Rect({shape:{x:n+r*u-1+_,y:o,width:2,height:tasks.length*(t+a)},style:{fill:"#2955c9"},z:1}),f=new zrender.Circle({shape:{cx:n+r*u+_,cy:o-s+s+2,r:3},style:{fill:"#2955c9"}});e.add(h),e.add(f)}const M={};M.show=function({currentIndex:e,position:{x:n,y:o}}){var s;if(!M.el){const t=document.querySelector("#contextMenu"),a=t.querySelector(".menu-item.copy"),r=t.querySelector(".menu-item.delete");r.onclick=function(i){i.preventDefault();const l=Number(t.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(l,1),syncLocal()),M.hide(),redrawChart(!0)},a.onclick=function(i){i.preventDefault();const l=Number(t.dataset.index),d={...tasks[l],duration:1};tasks.splice(l+1,0,d),console.log(tasks[l]),syncLocal(),M.hide(),redrawChart(!0)},M.el=t;const{left:h,top:f}=((s=document.querySelector("#zrender-container"))==null?void 0:s.getBoundingClientRect())||{left:0,top:0};M.offsetX=h,M.offsetY=f}M.el.style.display="block",M.el.dataset.index=e,M.el.style.left=`${n+M.offsetX}px`,M.el.style.top=`${o+M.offsetY}px`};M.hide=function(){M.el&&(M.el.style.display="none")};let xe=null,z=0+fe;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),S=me?$e():[{name:"Task 1",start:j+0,duration:3,resource:"John",fillColor:K()},{name:"Task 2",start:j+2,duration:4,resource:"Jane",fillColor:K()},{name:"Task 3 long long long",start:j+7,duration:1,resource:"Bob",fillColor:K()},{name:"Task 4",start:j+8,duration:2,resource:"Bose",fillColor:K()},{name:"Task 5",start:j+10,duration:3,resource:"Uno",fillColor:K()},{}],yt=S.pop();for(;S.length>1&&S.length<at;)S.push(...S.map(e=>({...e})));S.push(yt);window.tasks=S;const oe=me?$e("mileStones"):[{start:10,name:"提测"}];window.mileStones=oe;if(Ne){let e;m.dom.addEventListener("touchstart",function(n){v!=null&&v.resizing||v!=null&&v.dragging||(console.log(n),e=n.touches[0].clientX)}),m.dom.addEventListener("touchmove",function(n){if(v!=null&&v.resizing||v!=null&&v.dragging)return;n.preventDefault();let o=n.touches[0].clientX-e;e=n.touches[0].clientX,z-=Math.floor(o),X(!0,z,0),J.innerText=z})}else m.dom.addEventListener("click",function(){M.hide()}),m.on("mousewheel",function(e){e.event.preventDefault(),z-=Math.floor(e.event.wheelDeltaX*.01*tt),X(!0,z,0),J.innerText=z});window.addEventListener("resize",function(){m.resize(),X(!0)});ot(e=>z=e,e=>e,J,X);let ze=!0;function X(e=!1,n=z,o=0){const s=ze;ze&&(ze=!1);const t=Ge-n,a=Math.max(et,B+ae)-o;e&&m.clear();const r=m.getWidth(),h=m.getHeight(),f=Math.floor(z/u),i=Math.floor((z+r)/u);let l,d;function w(c){if(v!=null&&v.resizing||v!=null&&v.dragging)return;const k=c.event.zrX-t,E=c.event.zrY-a,x=Math.floor(k/u),p=Math.floor(E/(g+y));if(l!==[x,p].join())if(l=[x,p].join(),p>=0&&p<S.length){if(p!==S.length-1){d&&m.remove(d);return}const R=new zrender.Group;R.on("click",function(){console.log("dayHoverGroup clicked pos: ",[x,p]);const H=prompt("task name?");if(!H)return;const U=prompt("assign to who?")||Qe;S.splice(p,0,{name:H,start:x,duration:1,resource:U,fillColor:K()}),Y(),X(!0)});const O=new zrender.Rect({shape:{x:t+u*x+5,y:a+(g+y)*p,width:u-10,height:g+y},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),D=new zrender.Rect({shape:{x:t+z,y:a+(g+y)*p,width:u*C,height:g+y},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),q=new zrender.Line({shape:{x1:t+u*x+u/2-5,y1:a+(g+y)*p+(g+y)/2,x2:t+u*x+u/2+5,y2:a+(g+y)*p+(g+y)/2},style:{stroke:"gray"},z:100}),L=new zrender.Line({shape:{x1:t+u*x+u/2,y1:a+(g+y)*p+(g+y)/2-5,x2:t+u*x+u/2,y2:a+(g+y)*p+(g+y)/2+5},style:{stroke:"gray"},z:100});R.add(O),R.add(q),R.add(L),R.add(D),d&&m.remove(d),d=R,m.add(R)}else d&&m.remove(d)}xe&&m.off("mousemove",xe),xe=w,m.on("mousemove",w);const C=Math.ceil(r/u),$=new zrender.Rect({shape:{x:t+z,y:a-B,width:C*u,height:B},style:{fill:"rgba(255, 0,0, .2)"}});m.add($);const N=t,se=C*u,be=C+1,Pe=Math.floor(z/u);for(let c=0+Pe,k=0;k<be;c++,k++){const E=Math.min(S.length,(h-a)/(g+y)),x=N+c*u,p=new zrender.Line({shape:{x1:x,y1:a-B,x2:x,y2:a+(g+y)*E},style:{stroke:"lightgray"}});if(k<be-1){const R=+new Date("2024-01-01")+c*60*1e3*60*24,O=Be(R);if(O.isHoliday)try{Xe([[t+c*u,a],[t+c*u+u,a],[t+c*u+u,a+(g+y)*E],[t+c*u,a+(g+y)*E]],10,45).forEach(F=>{const[ie,ee]=F[0],[te,le]=F[1],de=new zrender.Line({shape:{x1:ie,y1:ee,x2:te,y2:le},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(de)})}catch(P){console.log(P)}const D=new zrender.Text({style:{text:O.dateString,x,y:a-B},z:1}),[q,{flag:L}]=st(m,x,_,a,B);D.on("click",function(){console.log("date text click",c);const P=oe.findIndex(F=>F.start===c);if(P===-1){if(confirm("Do you want to CREATE a milestone here?")){const F=prompt("mileStone name?");oe.push({start:c,name:F}),Y()}}else confirm("Do you want to DELETE the milestone here?")&&(oe.splice(P,1),Y());X(!0)}),D.on("mouseover",function(P){this.attr({style:{opacity:0}}),q.show()}),D.on("mouseout",function(P){this.attr({style:{opacity:1}}),q.hide()});const{width:H,height:U}=D.getBoundingRect();D.attr({style:{x:x-H/2+_,y:a-B-U/2+B/2}}),m.add(D)}m.add(p)}S.length+1;for(let c=0;c<1;c++){const k=a+c*(g+y),E=new zrender.Line({shape:{x1:t,y1:k,x2:se+t,y2:k},style:{stroke:"lightgray"}});m.add(E)}mt(m,t,a,B,g,y,j),oe.forEach(function(c){const k=new zrender.Rect({shape:{x:t+c.start*u-1,y:a-B,width:2,height:S.length*(g+y)+B},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),E=new zrender.Rect({shape:{x:t+c.start*u-1,y:a-B-ae,width:10,height:ae},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),x=new zrender.Text({style:{x:t+c.start*u-1+10,y:a-B-ae,text:c.name||"里程碑",fill:"white",lineHeight:ae,fontSize:12},z:1}),p=x.getBoundingRect();E.attr({shape:{width:p.width+10*2}}),m.add(k),m.add(E),m.add(x)});let ye=0;S.forEach(function(c,k){if(!(c!=null&&c.name)||k>Math.floor((h-a)/(g+y)))return;const E=c.start<=f,x=c.start+c.duration>i,p=t+c.start*u,G=a+(g+y)*k,R=c.duration*u,O={width:R,height:g},D=ft(p,G,c,O,E,f,function(){z=(c.start-3)*u,J.innerText=z,X(!0)}),q=gt(p,G,c,u,z,r,O,x,i,function(){z=(c.start+c.duration+3)*u-r,J.innerText=z,X(!0)});if(D&&m.add(D),q&&m.add(q),c.start>i||c.start+c.duration<f)return;ye++;const L=new zrender.Group({x:p,y:G,draggable:!Ne}),H=new zrender.Rect({shape:{x:0,y:0,width:R,height:g,r:6},style:{fill:c.fillColor},cursor:"move"});L.add(H),L.index=k;const U=6,P=H.getBoundingRect(),F=it(U,P,O,X);F.taskBar=H,L.add(F);const ie=lt(U,P,O,X);ie.taskBar=H,L.add(ie),L.on("mouseover",function(){this.dragging||H.attr("style",{fill:zrender.color.lift(c.fillColor,.3)})}),L.on("mouseout",function(){this.dragging||this.resizing||H.attr("style",{fill:c.fillColor})});const ee=new zrender.Text({style:{text:c.name,x:ce,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),te=new zrender.Text({style:{text:`${ut(c,nt)}天`,x:R-ce,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:le}=te.getBoundingRect();te.attr({style:{x:R-le-ce}});const de=new zrender.Text({style:{text:"Assigned to: "+c.resource,x:0+R+5,y:g/2+0-12/2,textFill:"black"},cursor:"normal"});ee.getBoundingRect().width+le+ce*2>R&&(de.attr({style:{text:c.name}}),ee.hide()),L.add(ee),L.add(te),L.add(de);let ke=0,Me=null,we=null;L.on("dragstart",function(I){this.resizing||(ke=I.event.zrX,Q(this))}),L.on("drag",function(I){if(this.resizing)return;const V=I.event.zrY-a,W=Math.floor(V/(g+y));if(Me!==W){Me=W,m.remove(we);const Z=ht(t,a,z,C,W);we=Z,Z&&m.add(Z),m.refresh()}}),L.on("dragend",function(I){if(this.isContextMenu){this.isContextMenu=!1;return}if(this.isDragging=!1,console.log("dragend"),this.resizing){this.resizing=!1;return}const V=I.event.zrX-ke,W=V<0?-1:1,Z=Math.abs(V),Oe=Z%u,Te=W*(Math.floor(Z/u)+Math.floor(Oe/_)),Fe=I.event.zrY-a,ne=Math.floor(Fe/(g+y)),Ye=ne-k;c.start+=Te,we&&ne!==k&&(S.splice(k,1),S.splice(ne>k?ne-1:ne,0,{...c})),(Te||Ye)&&Y(),Q(null),X(!0)}),L.eachChild(function(I){I.attr({z:10})}),L.on("dblclick",function(){T.show({currentIndex:this.index})}),L.on("contextmenu",function(I){this.isContextMenu=!0,I.event.preventDefault();const{zrX:V,zrY:W}=I.event;M.show({currentIndex:this.index,position:{x:V,y:W}})}),m.add(L)}),s&&ye===0&&S.length>0&&(console.log(S[0].start),z+=(S[0].start-f-1)*u,J.innerText,X(!0)),ge&&console.log({drawTaskBar:ye})}window.redrawChart=X;Le?(document.title+=" (Remote)",Ve(m,X)):(re&&Se("tasks",S.filter(e=>e.fillColor===re)),X());
