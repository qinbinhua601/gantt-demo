(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const q={};q.show=function(){if(!q.el){const t=document.querySelector(".popup-wrapper"),n=document.querySelector(".popup-wrapper__body"),r=t.querySelector("button.modify");t.addEventListener("click",function(){q.hide()}),r.onclick=function(a){a.preventDefault();const e=this.parentElement.previousElementSibling.value,o=Number(this.parentElement.previousElementSibling.dataset.index);tasks.splice(o,1,JSON.parse(e)),syncLocal(),q.hide(),redrawChart(!0)},n.onclick=function(a){a.stopPropagation()},q.el=t}q.el.style.display="flex"};q.hide=function(){q.el.style.display="none"};function St(t,n,r){if(t&&t.length){const[a,e]=n,o=Math.PI/180*r,i=Math.cos(o),u=Math.sin(o);for(const f of t){const[s,l]=f;f[0]=(s-a)*i-(l-e)*u+a,f[1]=(s-a)*u+(l-e)*i+e}}}function Wt(t,n,r){const a=[];t.forEach(e=>a.push(...e)),St(a,n,r)}function Yt(t,n){return t[0]===n[0]&&t[1]===n[1]}function Xt(t,n,r,a=1){const e=r,o=Math.max(n,.1),i=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,u=[0,0];if(e)for(const s of i)St(s,u,e);const f=jt(i,o,a);if(e){for(const s of i)St(s,u,-e);Wt(f,u,-e)}return f}function jt(t,n,r){const a=[];for(const s of t){const l=[...s];Yt(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&a.push(l)}const e=[];n=Math.max(n,.1);const o=[];for(const s of a)for(let l=0;l<s.length-1;l++){const c=s[l],z=s[l+1];if(c[1]!==z[1]){const R=Math.min(c[1],z[1]);o.push({ymin:R,ymax:Math.max(c[1],z[1]),x:R===c[1]?c[0]:z[0],islope:(z[0]-c[0])/(z[1]-c[1])})}}if(o.sort((s,l)=>s.ymin<l.ymin?-1:s.ymin>l.ymin?1:s.x<l.x?-1:s.x>l.x?1:s.ymax===l.ymax?0:(s.ymax-l.ymax)/Math.abs(s.ymax-l.ymax)),!o.length)return e;let i=[],u=o[0].ymin,f=0;for(;i.length||o.length;){if(o.length){let s=-1;for(let c=0;c<o.length&&!(o[c].ymin>u);c++)s=c;o.splice(0,s+1).forEach(c=>{i.push({s:u,edge:c})})}if(i=i.filter(s=>!(s.edge.ymax<=u)),i.sort((s,l)=>s.edge.x===l.edge.x?0:(s.edge.x-l.edge.x)/Math.abs(s.edge.x-l.edge.x)),(r!==1||f%n===0)&&i.length>1)for(let s=0;s<i.length;s=s+2){const l=s+1;if(l>=i.length)break;const c=i[s].edge,z=i[l].edge;e.push([[Math.round(c.x),u],[Math.round(z.x),u]])}u+=r,i.forEach(s=>{s.edge.x=s.edge.x+r*s.edge.islope}),f++}return e}window.hachureLines=Xt;const Rt={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"}};function At(t){const n=new Date(t),r=n.getMonth()+1+"",a=r.padStart(2,"0"),e=n.getDate()+"",o=e.padStart(2,"0"),i=`${a}-${o}`,u=[0,6].indexOf(n.getDay())!=-1;return Rt[i]?{isHoliday:Rt[i].holiday,dateString:`${r}-${e}`}:{isHoliday:u,dateString:`${r}-${e}`}}function L(t="unitWidth",n=!0){const r=new URLSearchParams(location.search);return r.get(t)&&n?Number(r.get(t)):r.get(t)}function F(){at||_t()||L("useLocal")&&Object.keys(ut).forEach(t=>{const n=localStorage.getItem(t);try{localStorage.setItem(t,JSON.stringify(window[t]))}catch{console.error("fail to syncLocal"),localStorage.setItem(t,n)}})}window.syncLocal=F;let pt=null;function _t(){if(L("useRemote")){const t={tasks:window.tasks,mileStones:window.mileStones};return pt&&clearTimeout(pt),pt=setTimeout(()=>{Bt(t).then(n=>{n.status===0&&console.log("recordUpdate成功",n)})},200),!0}return!1}const Et=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Bt(t){return fetch(`${Et}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:ht,...t})}).then(n=>n.json())}function Jt(){return console.log("current view",ht),fetch(`${Et}/record/query${ht?`?view=${ht}`:""}`).then(t=>t.json())}const ut={tasks:[{}],mileStones:[]};function Ht(t="tasks"){try{return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):ut[t]}catch{return console.error("fail to getLocal"),ut[t]}}function K(){const t=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),r=Math.floor(Math.random()*256);return"#"+t.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")+r.toString(16).padStart(2,"0")}function Ut(t,n){t.dom.style.opacity=0,Jt().then(r=>{const{data:a}=r;console.log(a),a!=null&&a.tasks||a!=null&&a.mileStones?(vt("tasks",a.tasks.filter(e=>at?e.fillColor===at:!0)),vt("mileStones",a.mileStones)):a||window.tasks.push({}),$t(a==null?void 0:a.tasks),n(!0),t.dom.style.opacity=1})}function Vt(t){const n=t?{view:`${t}`}:{};Bt({tasks:window.tasks,mileStones:window.mileStones,...n})}window.saveToRemote=Vt;function Zt(t){Object.keys(ut).forEach(n=>{const r=localStorage.getItem(n);try{localStorage.setItem(n,JSON.stringify(window[n]))}catch{console.error("fail to syncLocal"),localStorage.setItem(n,r)}})}window.saveToLocal=Zt;function vt(t,n){window[`old_${t}`]=[...window[t]],window[t].length=0,window[t].push(...n)}function Ct(t){var r;console.log(t.target);const n=new URLSearchParams(location.search);(r=t.target.dataset)!=null&&r.color?(t.target.dataset.hovered=!0,n.set("filter",t.target.dataset.color)):n.delete("filter"),location.href=`${location.pathname}?${n.toString()}`}function $t(t){if(!mt&&!bt||!Dt||!t)return;const n=t,r=document.querySelector("#color-picker");r.removeEventListener("click",Ct),r.addEventListener("click",Ct);const a=[...new Set(n.map(({fillColor:e})=>e)),""].filter(e=>e!==void 0).map(e=>`<div data-color="${e}" style="background-color: ${e};"></div>`);r.innerHTML=a.join("")}let v=null;const Q=t=>{v=t},gt=L("debug")??!1,Kt="alexq",h=L()??160,_=h/2,dt=L("taskNamePaddingLeft")??15,Qt=1,Gt=50,A=L("timeScaleHeight")??20,ot=L("milestoneTopHeight")??20,g=L("barHeight")??30,y=gt?10:L("barMargin")??1,te=L("scrollSpeed")??35,ee=L("includeHoliday")??!1,mt=L("useLocal"),bt=L("useRemote"),ht=L("view",!1)??"",ne=!bt&&!mt&&L("mockTaskSize")?Number(L("mockTaskSize")):0,j=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),ft=(j-1)*h,J=document.querySelector("#last-scroll-x");J.innerText=ft;const at=L("filter",!1)??null,Dt=L("showFilter")??!1,E=g/3*2,Nt=L("showArrow")??!0,Ot=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function oe(t,n,r,a){const e=document.querySelector("#back-to-origin-button");e==null||e.addEventListener("click",function(){t(ft),n(0),r.innerText=ft,a(!0)});const o=document.querySelector("#clear-button");o==null||o.addEventListener("click",function(){const u=tasks.length;tasks.length=0;for(let f=0;f<u;f++)tasks.push({});F(),a(!0)});const i=document.querySelector("#clear-milestone-button");i==null||i.addEventListener("click",function(){mileStones.length=0,F(),a(!0)}),Dt&&$t(window.tasks)}function re(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function ae(t,n,r,a,e){const o=new zrender.Group,i=re(),{width:u,height:f}=i.getBoundingRect();i.attr({x:n+r-u/2,y:a-e+e/2-f/2});const s=new zrender.Circle({shape:{cx:n+r+1,cy:a-e+e/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return o.add(s),o.add(i),o.hide(),t.add(o),[o,{flag:i,flagHoveredCircle:s}]}function ie(t,n,r,a){const{height:e,width:o}=r,i=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${gt?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});i.attr({x:n.x,y:n.y,shape:{x:-t/2,y:0}});let u=0,f=0,s=0;return i.on("dragstart",function(l){this.parent.resizing=!0,u=l.event.zrX;const c=this.taskBar;s=c.shape.width,f=c.shape.x,Q(this.parent)}),i.on("drag",function(l){const c=l.event.zrX-u;this.taskBar.attr({shape:{x:f+c,width:s-c}})}),i.on("dragend",function(l){const c=l.event.zrX-u,z=c<0?-1:1,R=Math.abs(c),H=R%h,N=z*(Math.floor(R/h)+Math.floor(H/_));console.log(N);const it=tasks[this.parent.index];it.start+=N,it.duration-=N,N&&F(),Q(null),a(!0)}),i}function se(t,n,r,a){const{height:e,width:o}=r,i=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${gt?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});i.attr({x:n.x+o,y:n.y,shape:{x:-t/2,y:0}});let u=0,f=0;return i.on("dragstart",function(s){this.parent.resizing=!0,u=s.event.zrX;const l=this.taskBar;f=l.shape.width,l.shape.x,console.log(v),Q(this.parent)}),i.on("drag",function(s){const l=s.event.zrX-u;this.taskBar.attr({shape:{width:f+l}})}),i.on("dragend",function(s){const l=s.event.zrX-u,c=l<0?-1:1,z=Math.abs(l),R=z%h,H=c*(Math.floor(z/h)+Math.floor(R/_)),N=tasks[this.parent.index];N.duration+=H,H&&F(),Q(null),a(!0)}),i}const le=+new Date("2024-01-01"),ce=60*60*24*1e3;function de(t,n){const{start:r,duration:a}=t;if(n)return t.duration;let e=0;const o=a+r;for(let i=r;i<o;i++)At(new Date(le+ce*i)).isHoliday||e++;return e}function he(t,n,r,a,e){return e<0||e>tasks.length-1?null:new zrender.Rect({shape:{x:t+r,y:n+(g+y)*e,width:a*h,height:1},style:{fill:"blue"},zlevel:1})}function ue(t,n,r,a,e,o,i){if(!Nt)return;const u=1e3,f=new zrender.Group({x:5,y:n+(a.height-E)/2}),s=new zrender.Text({x:E*.1,style:{text:"←",fill:"rgb(101, 116, 114)",fontSize:E*.8,textAlign:"center",lineHeight:E},z:u+1,name:"leftArrowText"});f.add(s);const l=new zrender.Rect({shape:{width:E,height:E,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:u,name:"leftArrowRect"});return f.on("mouseover",function(){o>=r.start+r.duration&&this.childOfName("leftArrowRect").attr({style:{fill:r.fillColor}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),f.on("mouseout",function(){this.childOfName("leftArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),f.on("click",i),f.add(l),e||f.eachChild(function(c){c.hide()}),f}function fe(t,n,r,a,e,o,i,u,f,s){if(!Nt)return;const l=1e3,c=new zrender.Group({x:t+e+o-E-10-r.start*a,y:n+(i.height-E)/2}),z=new zrender.Text({x:E*.1,style:{text:"→",fill:"rgb(101, 116, 114)",fontSize:E*.8,textAlign:"center",lineHeight:E},z:l+1,name:"rightArrowText"});c.add(z);const R=new zrender.Rect({shape:{width:E,height:E,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:l,name:"rightArrowRect"});return c.on("mouseover",function(){const H=this.childOfName("rightArrowRect");f<r.start&&H.attr({style:{fill:r.fillColor}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),c.on("mouseout",function(){this.childOfName("rightArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),c.on("click",s),c.add(R),u||c.eachChild(function(H){H.hide()}),c}function ge(t,n,r,a,e,o,i){const u=new zrender.Rect({shape:{x:n+i*h-1+_,y:r,width:2,height:tasks.length*(e+o)},style:{fill:"#2955c9"},z:1}),f=new zrender.Circle({shape:{cx:n+i*h+_,cy:r-a+a+2,r:3},style:{fill:"#2955c9"}});t.add(u),t.add(f)}const M={};M.show=function({currentIndex:t,position:{x:n,y:r}}){var a;if(!M.el){const e=document.querySelector("#contextMenu"),o=e.querySelector(".menu-item.copy"),i=e.querySelector(".menu-item.delete");i.onclick=function(s){s.preventDefault();const l=Number(e.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(l,1),syncLocal()),M.hide(),redrawChart(!0)},o.onclick=function(s){s.preventDefault();const l=Number(e.dataset.index),c={...tasks[l],duration:1};tasks.splice(l+1,0,c),console.log(tasks[l]),syncLocal(),M.hide(),redrawChart(!0)},M.el=e;const{left:u,top:f}=((a=document.querySelector("#zrender-container"))==null?void 0:a.getBoundingClientRect())||{left:0,top:0};M.offsetX=u,M.offsetY=f}M.el.style.display="block",M.el.dataset.index=t,M.el.style.left=`${n+M.offsetX}px`,M.el.style.top=`${r+M.offsetY}px`};M.hide=function(){M.el.style.display="none"};let xt=null,S=0+ft;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),p=mt?Ht():[{name:"Task 1",start:j+0,duration:3,resource:"John",fillColor:K()},{name:"Task 2",start:j+2,duration:4,resource:"Jane",fillColor:K()},{name:"Task 3 long long long",start:j+7,duration:1,resource:"Bob",fillColor:K()},{name:"Task 4",start:j+8,duration:2,resource:"Bose",fillColor:K()},{name:"Task 5",start:j+10,duration:3,resource:"Uno",fillColor:K()},{}],me=p.pop();for(;p.length>1&&p.length<ne;)p.push(...p.map(t=>({...t})));p.push(me);window.tasks=p;const rt=mt?Ht("mileStones"):[{start:10,name:"提测"}];window.mileStones=rt;if(Ot){let t;m.dom.addEventListener("touchstart",function(n){v!=null&&v.resizing||v!=null&&v.dragging||(console.log(n),t=n.touches[0].clientX)}),m.dom.addEventListener("touchmove",function(n){if(v!=null&&v.resizing||v!=null&&v.dragging)return;n.preventDefault();let r=n.touches[0].clientX-t;t=n.touches[0].clientX,S-=Math.floor(r),C(!0,S,0),J.innerText=S})}else m.dom.addEventListener("click",function(){M.hide()}),m.on("mousewheel",function(t){t.event.preventDefault(),S-=Math.floor(t.event.wheelDeltaX*.01*te),C(!0,S,0),J.innerText=S});window.addEventListener("resize",function(){m.resize(),C(!0)});oe(t=>S=t,t=>t,J,C);let zt=!0;function C(t=!1,n=S,r=0){const a=zt;zt&&(zt=!1);const e=Qt-n,o=Math.max(Gt,A+ot)-r;t&&m.clear();const i=m.getWidth(),u=m.getHeight(),f=Math.floor(S/h),s=Math.floor((S+i)/h);let l,c;function z(d){if(v!=null&&v.resizing||v!=null&&v.dragging)return;const k=d.event.zrX-e,B=d.event.zrY-o,x=Math.floor(k/h),w=Math.floor(B/(g+y));if(l!==[x,w].join())if(l=[x,w].join(),w>=0&&w<p.length){if(x>=p[w].start&&x<p[w].start+p[w].duration){c&&m.remove(c);return}const T=new zrender.Group;T.on("click",function(){console.log("dayHoverGroup clicked pos: ",[x,w]);const D=prompt("task name?");if(!D)return;const U=prompt("assign to who?")||Kt;p.splice(w,0,{name:D,start:x,duration:1,resource:U,fillColor:K()}),F(),C(!0)});const P=new zrender.Rect({shape:{x:e+h*x+5,y:o+(g+y)*w,width:h-10,height:g+y},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),$=new zrender.Rect({shape:{x:e+S,y:o+(g+y)*w,width:h*R,height:g+y},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),W=new zrender.Line({shape:{x1:e+h*x+h/2-5,y1:o+(g+y)*w+(g+y)/2,x2:e+h*x+h/2+5,y2:o+(g+y)*w+(g+y)/2},style:{stroke:"gray"},z:100}),b=new zrender.Line({shape:{x1:e+h*x+h/2,y1:o+(g+y)*w+(g+y)/2-5,x2:e+h*x+h/2,y2:o+(g+y)*w+(g+y)/2+5},style:{stroke:"gray"},z:100});T.add(P),T.add(W),T.add(b),T.add($),c&&m.remove(c),c=T,m.add(T)}else c&&m.remove(c)}xt&&m.off("mousemove",xt),xt=z,m.on("mousemove",z);const R=Math.ceil(i/h),H=new zrender.Rect({shape:{x:e+S,y:o-A,width:R*h,height:A},style:{fill:"rgba(255, 0,0, .2)"}});m.add(H);const N=e,it=R*h,Lt=R+1,Pt=Math.floor(S/h);for(let d=0+Pt,k=0;k<Lt;d++,k++){const B=Math.min(p.length,(u-o)/(g+y)),x=N+d*h,w=new zrender.Line({shape:{x1:x,y1:o-A,x2:x,y2:o+(g+y)*B},style:{stroke:"lightgray"}});if(k<Lt-1){const T=+new Date("2024-01-01")+d*60*1e3*60*24,P=At(T);if(P.isHoliday)try{Xt([[e+d*h,o],[e+d*h+h,o],[e+d*h+h,o+(g+y)*B],[e+d*h,o+(g+y)*B]],10,45).forEach(I=>{const[st,tt]=I[0],[et,lt]=I[1],ct=new zrender.Line({shape:{x1:st,y1:tt,x2:et,y2:lt},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(ct)})}catch(O){console.log(O)}const $=new zrender.Text({style:{text:P.dateString,x,y:o-A},z:1}),[W,{flag:b}]=ae(m,x,_,o,A);$.on("click",function(){console.log("date text click",d);const O=rt.findIndex(I=>I.start===d);if(O===-1){if(confirm("Do you want to CREATE a milestone here?")){const I=prompt("mileStone name?");rt.push({start:d,name:I}),F()}}else confirm("Do you want to DELETE the milestone here?")&&(rt.splice(O,1),F());C(!0)}),$.on("mouseover",function(O){this.attr({style:{opacity:0}}),W.show()}),$.on("mouseout",function(O){this.attr({style:{opacity:1}}),W.hide()});const{width:D,height:U}=$.getBoundingRect();$.attr({style:{x:x-D/2+_,y:o-A-U/2+A/2}}),m.add($)}m.add(w)}p.length+1;for(let d=0;d<1;d++){const k=o+d*(g+y),B=new zrender.Line({shape:{x1:e,y1:k,x2:it+e,y2:k},style:{stroke:"lightgray"}});m.add(B)}ge(m,e,o,A,g,y,j),rt.forEach(function(d){const k=new zrender.Rect({shape:{x:e+d.start*h-1,y:o-A,width:2,height:p.length*(g+y)+A},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),B=new zrender.Rect({shape:{x:e+d.start*h-1,y:o-A-ot,width:10,height:ot},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),x=new zrender.Text({style:{x:e+d.start*h-1+10,y:o-A-ot,text:d.name||"里程碑",fill:"white",lineHeight:ot,fontSize:12},z:1}),w=x.getBoundingRect();B.attr({shape:{width:w.width+10*2}}),m.add(k),m.add(B),m.add(x)});let yt=0;p.forEach(function(d,k){if(!(d!=null&&d.name)||k>Math.floor((u-o)/(g+y)))return;const B=d.start<=f,x=d.start+d.duration>s,w=e+d.start*h,G=o+(g+y)*k,T=d.duration*h,P={width:T,height:g},$=ue(w,G,d,P,B,f,function(){S=(d.start-3)*h,J.innerText=S,C(!0)}),W=fe(w,G,d,h,S,i,P,x,s,function(){S=(d.start+d.duration+3)*h-i,J.innerText=S,C(!0)});if($&&m.add($),W&&m.add(W),d.start>s||d.start+d.duration<f)return;yt++;const b=new zrender.Group({x:w,y:G,draggable:!Ot}),D=new zrender.Rect({shape:{x:0,y:0,width:T,height:g,r:6},style:{fill:d.fillColor},cursor:"move"});b.add(D),b.index=k;const U=6,O=D.getBoundingRect(),I=ie(U,O,P,C);I.taskBar=D,b.add(I);const st=se(U,O,P,C);st.taskBar=D,b.add(st),b.on("mouseover",function(){this.dragging||D.attr("style",{fill:zrender.color.lift(d.fillColor,.3)})}),b.on("mouseout",function(){this.dragging||this.resizing||D.attr("style",{fill:d.fillColor})});const tt=new zrender.Text({style:{text:d.name,x:dt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),et=new zrender.Text({style:{text:`${de(d,ee)}天`,x:T-dt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:lt}=et.getBoundingRect();et.attr({style:{x:T-lt-dt}});const ct=new zrender.Text({style:{text:"Assigned to: "+d.resource,x:0+T+5,y:g/2+0-12/2,textFill:"black"},cursor:"normal"});tt.getBoundingRect().width+lt+dt*2>T&&(ct.attr({style:{text:d.name}}),tt.hide()),b.add(tt),b.add(et),b.add(ct);let kt=0,Mt=null,wt=null;b.on("dragstart",function(X){this.resizing||(kt=X.event.zrX,Q(this))}),b.on("drag",function(X){if(this.resizing)return;const V=X.event.zrY-o,Y=Math.floor(V/(g+y));if(Mt!==Y){Mt=Y,m.remove(wt);const Z=he(e,o,S,R,Y);wt=Z,Z&&m.add(Z),m.refresh()}}),b.on("dragend",function(X){if(this.isContextMenu){this.isContextMenu=!1;return}if(this.isDragging=!1,console.log("dragend"),this.resizing){this.resizing=!1;return}const V=X.event.zrX-kt,Y=V<0?-1:1,Z=Math.abs(V),It=Z%h,Tt=Y*(Math.floor(Z/h)+Math.floor(It/_)),qt=X.event.zrY-o,nt=Math.floor(qt/(g+y)),Ft=nt-k;d.start+=Tt,wt&&nt!==k&&(p.splice(k,1),p.splice(nt>k?nt-1:nt,0,{...d})),(Tt||Ft)&&F(),Q(null),C(!0)}),b.eachChild(function(X){X.attr({z:10})}),b.on("dblclick",function(){q.show();const X=document.querySelector("#current-task");X.value=JSON.stringify(p[this.index],null,2),X.dataset.index=this.index}),b.on("contextmenu",function(X){this.isContextMenu=!0,X.event.preventDefault();const{zrX:V,zrY:Y}=X.event;M.show({currentIndex:this.index,position:{x:V,y:Y}})}),m.add(b)}),a&&yt===0&&p.length>0&&(console.log(p[0].start),S+=(p[0].start-f-1)*h,J.innerText,C(!0)),gt&&console.log({drawTaskBar:yt})}window.redrawChart=C;bt?(document.title+=" (Remote)",Ut(m,C)):(at&&vt("tasks",p.filter(t=>t.fillColor===at)),C());
