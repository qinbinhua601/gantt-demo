(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const N={};N.show=function(){if(!N.el){const t=document.querySelector(".popup-wrapper"),o=document.querySelector(".popup-wrapper__body"),a=t.querySelector("button.modify"),i=t.querySelector("button.delete"),e=t.querySelector("button.copy");t.addEventListener("click",function(){N.hide()}),a.onclick=function(n){n.preventDefault();const r=this.parentElement.previousElementSibling.value,h=Number(this.parentElement.previousElementSibling.dataset.index);tasks.splice(h,1,JSON.parse(r)),syncLocal(),N.hide(),redrawChart(!0)},i.onclick=function(n){n.preventDefault();const r=Number(this.parentElement.previousElementSibling.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(r,1),syncLocal()),N.hide(),redrawChart(!0)},e.onclick=function(n){n.preventDefault();const r=Number(this.parentElement.previousElementSibling.dataset.index),h={...tasks[r],duration:1};tasks.splice(r+1,0,h),console.log(tasks[r]),syncLocal(),N.hide(),redrawChart(!0)},o.onclick=function(n){n.stopPropagation()},N.el=t}N.el.style.display="flex"};N.hide=function(){N.el.style.display="none"};function xt(t,o,a){if(t&&t.length){const[i,e]=o,n=Math.PI/180*a,r=Math.cos(n),h=Math.sin(n);for(const f of t){const[s,l]=f;f[0]=(s-i)*r-(l-e)*h+i,f[1]=(s-i)*h+(l-e)*r+e}}}function Ft(t,o,a){const i=[];t.forEach(e=>i.push(...e)),xt(i,o,a)}function qt(t,o){return t[0]===o[0]&&t[1]===o[1]}function Mt(t,o,a,i=1){const e=a,n=Math.max(o,.1),r=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,h=[0,0];if(e)for(const s of r)xt(s,h,e);const f=Wt(r,n,i);if(e){for(const s of r)xt(s,h,-e);Ft(f,h,-e)}return f}function Wt(t,o,a){const i=[];for(const s of t){const l=[...s];qt(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&i.push(l)}const e=[];o=Math.max(o,.1);const n=[];for(const s of i)for(let l=0;l<s.length-1;l++){const c=s[l],z=s[l+1];if(c[1]!==z[1]){const T=Math.min(c[1],z[1]);n.push({ymin:T,ymax:Math.max(c[1],z[1]),x:T===c[1]?c[0]:z[0],islope:(z[0]-c[0])/(z[1]-c[1])})}}if(n.sort((s,l)=>s.ymin<l.ymin?-1:s.ymin>l.ymin?1:s.x<l.x?-1:s.x>l.x?1:s.ymax===l.ymax?0:(s.ymax-l.ymax)/Math.abs(s.ymax-l.ymax)),!n.length)return e;let r=[],h=n[0].ymin,f=0;for(;r.length||n.length;){if(n.length){let s=-1;for(let c=0;c<n.length&&!(n[c].ymin>h);c++)s=c;n.splice(0,s+1).forEach(c=>{r.push({s:h,edge:c})})}if(r=r.filter(s=>!(s.edge.ymax<=h)),r.sort((s,l)=>s.edge.x===l.edge.x?0:(s.edge.x-l.edge.x)/Math.abs(s.edge.x-l.edge.x)),(a!==1||f%o===0)&&r.length>1)for(let s=0;s<r.length;s=s+2){const l=s+1;if(l>=r.length)break;const c=r[s].edge,z=r[l].edge;e.push([[Math.round(c.x),h],[Math.round(z.x),h]])}h+=a,r.forEach(s=>{s.edge.x=s.edge.x+a*s.edge.islope}),f++}return e}window.hachureLines=Mt;const Tt={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"}};function At(t){const o=new Date(t),a=o.getMonth()+1+"",i=a.padStart(2,"0"),e=o.getDate()+"",n=e.padStart(2,"0"),r=`${i}-${n}`,h=[0,6].indexOf(o.getDay())!=-1;return Tt[r]?{isHoliday:Tt[r].holiday,dateString:`${a}-${e}`}:{isHoliday:h,dateString:`${a}-${e}`}}function S(t="unitWidth",o=!0){const a=new URLSearchParams(location.search);return a.get(t)&&o?Number(a.get(t)):a.get(t)}function I(){nt||jt()||S("useLocal")&&Object.keys(dt).forEach(t=>{const o=localStorage.getItem(t);try{localStorage.setItem(t,JSON.stringify(window[t]))}catch{console.error("fail to syncLocal"),localStorage.setItem(t,o)}})}window.syncLocal=I;let yt=null;function jt(){if(S("useRemote")){const t={tasks:window.tasks,mileStones:window.mileStones};return yt&&clearTimeout(yt),yt=setTimeout(()=>{Et(t).then(o=>{o.status===0&&console.log("recordUpdate成功",o)})},200),!0}return!1}const Ct=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Et(t){return fetch(`${Ct}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:ct,...t})}).then(o=>o.json())}function _t(){return console.log("current view",ct),fetch(`${Ct}/record/query${ct?`?view=${ct}`:""}`).then(t=>t.json())}const dt={tasks:[{}],mileStones:[]};function Bt(t="tasks"){try{return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):dt[t]}catch{return console.error("fail to getLocal"),dt[t]}}function G(){const t=Math.floor(Math.random()*256),o=Math.floor(Math.random()*256),a=Math.floor(Math.random()*256);return"#"+t.toString(16).padStart(2,"0")+o.toString(16).padStart(2,"0")+a.toString(16).padStart(2,"0")}function Gt(t,o){t.dom.style.opacity=0,_t().then(a=>{const{data:i}=a;console.log(i),i!=null&&i.tasks||i!=null&&i.mileStones?(zt("tasks",i.tasks.filter(e=>nt?e.fillColor===nt:!0)),zt("mileStones",i.mileStones)):i||window.tasks.push({}),Ht(i==null?void 0:i.tasks),o(!0),t.dom.style.opacity=1})}function Jt(t){const o=t?{view:`${t}`}:{};Et({tasks:window.tasks,mileStones:window.mileStones,...o})}window.saveToRemote=Jt;function Yt(t){Object.keys(dt).forEach(o=>{const a=localStorage.getItem(o);try{localStorage.setItem(o,JSON.stringify(window[o]))}catch{console.error("fail to syncLocal"),localStorage.setItem(o,a)}})}window.saveToLocal=Yt;function zt(t,o){window[`old_${t}`]=[...window[t]],window[t].length=0,window[t].push(...o)}function Rt(t){var a;console.log(t.target);const o=new URLSearchParams(location.search);(a=t.target.dataset)!=null&&a.color?(t.target.dataset.hovered=!0,o.set("filter",t.target.dataset.color)):o.delete("filter"),location.href=`${location.pathname}?${o.toString()}`}function Ht(t){if(!ft&&!St||!Nt||!t)return;const o=t,a=document.querySelector("#color-picker");a.removeEventListener("click",Rt),a.addEventListener("click",Rt);const i=[...new Set(o.map(({fillColor:e})=>e)),""].filter(e=>e!==void 0).map(e=>`<div data-color="${e}" style="background-color: ${e};"></div>`);a.innerHTML=i.join("")}let F=null;const Y=t=>{F=t},ht=S("debug")??!1,Ut="alexq",u=S()??160,W=u/2,lt=S("taskNamePaddingLeft")??15,Vt=1,Zt=50,M=S("timeScaleHeight")??20,tt=S("milestoneTopHeight")??20,g=S("barHeight")??30,y=ht?10:S("barMargin")??1,Kt=S("scrollSpeed")??35,Qt=S("includeHoliday")??!1,ft=S("useLocal"),St=S("useRemote"),ct=S("view",!1)??"",te=!St&&!ft&&S("mockTaskSize")?Number(S("mockTaskSize")):0,Xt=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),ut=(Xt-1)*u,J=document.querySelector("#last-scroll-x");J.innerText=ut;const nt=S("filter",!1)??null,Nt=S("showFilter")??!1,A=g/3*2,$t=S("showArrow")??!0;function ee(t,o,a,i){const e=document.querySelector("#back-to-origin-button");e==null||e.addEventListener("click",function(){t(ut),o(0),a.innerText=ut,i(!0)});const n=document.querySelector("#clear-button");n==null||n.addEventListener("click",function(){const h=tasks.length;tasks.length=0;for(let f=0;f<h;f++)tasks.push({});I(),i(!0)});const r=document.querySelector("#clear-milestone-button");r==null||r.addEventListener("click",function(){mileStones.length=0,I(),i(!0)}),Nt&&Ht(window.tasks)}function ne(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function oe(t,o,a,i,e){const n=new zrender.Group,r=ne(),{width:h,height:f}=r.getBoundingRect();r.attr({x:o+a-h/2,y:i-e+e/2-f/2});const s=new zrender.Circle({shape:{cx:o+a+1,cy:i-e+e/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return n.add(s),n.add(r),n.hide(),t.add(n),[n,{flag:r,flagHoveredCircle:s}]}function re(t,o,a,i){const{height:e,width:n}=a,r=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${ht?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:o.x,y:o.y,shape:{x:-t/2,y:0}});let h=0,f=0,s=0;return r.on("dragstart",function(l){this.parent.resizing=!0,h=l.event.zrX;const c=this.taskBar;s=c.shape.width,f=c.shape.x,Y(this.parent)}),r.on("drag",function(l){const c=l.event.zrX-h;this.taskBar.attr({shape:{x:f+c,width:s-c}})}),r.on("dragend",function(l){const c=l.event.zrX-h,z=c<0?-1:1,T=Math.abs(c),E=T%u,$=z*(Math.floor(T/u)+Math.floor(E/W));console.log($);const ot=tasks[this.parent.index];ot.start+=$,ot.duration-=$,$&&I(),Y(null),i(!0)}),r}function ae(t,o,a,i){const{height:e,width:n}=a,r=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${ht?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:o.x+n,y:o.y,shape:{x:-t/2,y:0}});let h=0,f=0;return r.on("dragstart",function(s){this.parent.resizing=!0,h=s.event.zrX;const l=this.taskBar;f=l.shape.width,l.shape.x,console.log(F),Y(this.parent)}),r.on("drag",function(s){const l=s.event.zrX-h;this.taskBar.attr({shape:{width:f+l}})}),r.on("dragend",function(s){const l=s.event.zrX-h,c=l<0?-1:1,z=Math.abs(l),T=z%u,E=c*(Math.floor(z/u)+Math.floor(T/W)),$=tasks[this.parent.index];$.duration+=E,E&&I(),Y(null),i(!0)}),r}const ie=+new Date("2024-01-01"),se=60*60*24*1e3;function le(t,o){const{start:a,duration:i}=t;if(o)return t.duration;let e=0;const n=i+a;for(let r=a;r<n;r++)At(new Date(ie+se*r)).isHoliday||e++;return e}function ce(t,o,a,i,e){return e<0||e>tasks.length-1?null:new zrender.Rect({shape:{x:t+a,y:o+(g+y)*e,width:i*u,height:1},style:{fill:"blue"},zlevel:1})}function de(t,o,a,i,e,n,r){if(!$t)return;const h=1e3,f=new zrender.Group({x:5,y:o+(i.height-A)/2}),s=new zrender.Text({x:A*.1,style:{text:"←",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:h+1,name:"leftArrowText"});f.add(s);const l=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:h,name:"leftArrowRect"});return f.on("mouseover",function(){n>=a.start+a.duration&&this.childOfName("leftArrowRect").attr({style:{fill:a.fillColor}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),f.on("mouseout",function(){this.childOfName("leftArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),f.on("click",r),f.add(l),e||f.eachChild(function(c){c.hide()}),f}function ue(t,o,a,i,e,n,r,h,f,s){if(!$t)return;const l=1e3,c=new zrender.Group({x:t+e+n-A-10-a.start*i,y:o+(r.height-A)/2}),z=new zrender.Text({x:A*.1,style:{text:"→",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:l+1,name:"rightArrowText"});c.add(z);const T=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:l,name:"rightArrowRect"});return c.on("mouseover",function(){const E=this.childOfName("rightArrowRect");f<a.start&&E.attr({style:{fill:a.fillColor}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),c.on("mouseout",function(){this.childOfName("rightArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),c.on("click",s),c.add(T),h||c.eachChild(function(E){E.hide()}),c}function he(t,o,a,i,e,n,r){const h=new zrender.Rect({shape:{x:o+r*u-1+W,y:a,width:2,height:tasks.length*(e+n)},style:{fill:"#2955c9"},z:1}),f=new zrender.Circle({shape:{cx:o+r*u+W,cy:a-i+i+2,r:3},style:{fill:"#2955c9"}});t.add(h),t.add(f)}let wt=null,L=0+ut;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),p=ft?Bt():[{name:"Task 1",start:0,duration:3,resource:"John",fillColor:G()},{name:"Task 2",start:2,duration:4,resource:"Jane",fillColor:G()},{name:"Task 3 long long long",start:7,duration:1,resource:"Bob",fillColor:G()},{name:"Task 4",start:8,duration:2,resource:"Bose",fillColor:G()},{name:"Task 5",start:10,duration:3,resource:"Uno",fillColor:G()},{}],fe=p.pop();for(;p.length>1&&p.length<te;)p.push(...p.map(t=>({...t})));p.push(fe);window.tasks=p;const et=ft?Bt("mileStones"):[{start:10,name:"提测"}];window.mileStones=et;m.on("mousewheel",function(t){t.event.preventDefault(),L-=Math.floor(t.event.wheelDeltaX*.01*Kt),R(!0,L,0),J.innerText=L});window.addEventListener("resize",function(){m.resize(),R(!0)});ee(t=>L=t,t=>t,J,R);let pt=!0;function R(t=!1,o=L,a=0){const i=pt;pt&&(pt=!1);const e=Vt-o,n=Math.max(Zt,M+tt)-a;t&&m.clear();const r=m.getWidth(),h=m.getHeight(),f=Math.floor(L/u),s=Math.floor((L+r)/u);let l,c;function z(d){if(F!=null&&F.resizing||F!=null&&F.dragging)return;const v=d.event.zrX-e,C=d.event.zrY-n,x=Math.floor(v/u),w=Math.floor(C/(g+y));if(l!==[x,w].join())if(l=[x,w].join(),w>=0&&w<p.length){if(x>=p[w].start&&x<p[w].start+p[w].duration){c&&m.remove(c);return}const k=new zrender.Group;k.on("click",function(){console.log("dayHoverGroup clicked pos: ",[x,w]);const H=prompt("task name?");if(!H)return;const j=prompt("assign to who?")||Ut;p.splice(w,0,{name:H,start:x,duration:1,resource:j,fillColor:G()}),I(),R(!0)});const O=new zrender.Rect({shape:{x:e+u*x+5,y:n+(g+y)*w,width:u-10,height:g+y},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),B=new zrender.Rect({shape:{x:e+L,y:n+(g+y)*w,width:u*T,height:g+y},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),q=new zrender.Line({shape:{x1:e+u*x+u/2-5,y1:n+(g+y)*w+(g+y)/2,x2:e+u*x+u/2+5,y2:n+(g+y)*w+(g+y)/2},style:{stroke:"gray"},z:100}),b=new zrender.Line({shape:{x1:e+u*x+u/2,y1:n+(g+y)*w+(g+y)/2-5,x2:e+u*x+u/2,y2:n+(g+y)*w+(g+y)/2+5},style:{stroke:"gray"},z:100});k.add(O),k.add(q),k.add(b),k.add(B),c&&m.remove(c),c=k,m.add(k)}else c&&m.remove(c)}wt&&m.off("mousemove",wt),wt=z,m.on("mousemove",z);const T=Math.ceil(r/u),E=new zrender.Rect({shape:{x:e+L,y:n-M,width:T*u,height:M},style:{fill:"rgba(255, 0,0, .2)"}});m.add(E);const $=e,ot=T*u,vt=T+1,Dt=Math.floor(L/u);for(let d=0+Dt,v=0;v<vt;d++,v++){const C=Math.min(p.length,(h-n)/(g+y)),x=$+d*u,w=new zrender.Line({shape:{x1:x,y1:n-M,x2:x,y2:n+(g+y)*C},style:{stroke:"lightgray"}});if(v<vt-1){const k=+new Date("2024-01-01")+d*60*1e3*60*24,O=At(k);if(O.isHoliday)try{Mt([[e+d*u,n],[e+d*u+u,n],[e+d*u+u,n+(g+y)*C],[e+d*u,n+(g+y)*C]],10,45).forEach(P=>{const[rt,V]=P[0],[Z,at]=P[1],it=new zrender.Line({shape:{x1:rt,y1:V,x2:Z,y2:at},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(it)})}catch(D){console.log(D)}const B=new zrender.Text({style:{text:O.dateString,x,y:n-M},z:1}),[q,{flag:b}]=oe(m,x,W,n,M);B.on("click",function(){console.log("date text click",d);const D=et.findIndex(P=>P.start===d);if(D===-1){if(confirm("Do you want to CREATE a milestone here?")){const P=prompt("mileStone name?");et.push({start:d,name:P}),I()}}else confirm("Do you want to DELETE the milestone here?")&&(et.splice(D,1),I());R(!0)}),B.on("mouseover",function(D){this.attr({style:{opacity:0}}),q.show()}),B.on("mouseout",function(D){this.attr({style:{opacity:1}}),q.hide()});const{width:H,height:j}=B.getBoundingRect();B.attr({style:{x:x-H/2+W,y:n-M-j/2+M/2}}),m.add(B)}m.add(w)}p.length+1;for(let d=0;d<1;d++){const v=n+d*(g+y),C=new zrender.Line({shape:{x1:e,y1:v,x2:ot+e,y2:v},style:{stroke:"lightgray"}});m.add(C)}he(m,e,n,M,g,y,Xt),et.forEach(function(d){const v=new zrender.Rect({shape:{x:e+d.start*u-1,y:n-M,width:2,height:p.length*(g+y)+M},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),C=new zrender.Rect({shape:{x:e+d.start*u-1,y:n-M-tt,width:10,height:tt},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),x=new zrender.Text({style:{x:e+d.start*u-1+10,y:n-M-tt,text:d.name||"里程碑",fill:"white",lineHeight:tt,fontSize:12},z:1}),w=x.getBoundingRect();C.attr({shape:{width:w.width+10*2}}),m.add(v),m.add(C),m.add(x)});let gt=0;p.forEach(function(d,v){if(!(d!=null&&d.name)||v>Math.floor((h-n)/(g+y)))return;const C=d.start<=f,x=d.start+d.duration>s;gt++;const w=e+d.start*u,U=n+(g+y)*v,k=d.duration*u,O={width:k,height:g},B=de(w,U,d,O,C,f,function(){L=(d.start-3)*u,J.innerText=L,R(!0)}),q=ue(w,U,d,u,L,r,O,x,s,function(){L=(d.start+d.duration+3)*u-r,J.innerText=L,R(!0)});if(B&&m.add(B),q&&m.add(q),d.start>s||d.start+d.duration<f)return;const b=new zrender.Group({x:w,y:U,draggable:!0}),H=new zrender.Rect({shape:{x:0,y:0,width:k,height:g,r:6},style:{fill:d.fillColor},cursor:"move"});b.add(H),b.index=v;const j=6,D=H.getBoundingRect(),P=re(j,D,O,R);P.taskBar=H,b.add(P);const rt=ae(j,D,O,R);rt.taskBar=H,b.add(rt),b.on("mouseover",function(){this.dragging||H.attr("style",{fill:zrender.color.lift(d.fillColor,.3)})}),b.on("mouseout",function(){this.dragging||this.resizing||H.attr("style",{fill:d.fillColor})});const V=new zrender.Text({style:{text:d.name,x:lt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),Z=new zrender.Text({style:{text:`${le(d,Qt)}天`,x:k-lt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:at}=Z.getBoundingRect();Z.attr({style:{x:k-at-lt}});const it=new zrender.Text({style:{text:"Assigned to: "+d.resource,x:0+k+5,y:g/2+0-12/2,textFill:"black"},cursor:"normal"});V.getBoundingRect().width+at+lt*2>k&&(it.attr({style:{text:d.name}}),V.hide()),b.add(V),b.add(Z),b.add(it);let bt=0,Lt=null,mt=null;b.on("dragstart",function(X){this.resizing||(bt=X.event.zrX,Y(this))}),b.on("drag",function(X){if(this.resizing)return;const st=X.event.zrY-n,K=Math.floor(st/(g+y));if(Lt!==K){Lt=K,m.remove(mt);const _=ce(e,n,L,T,K);mt=_,_&&m.add(_),m.refresh()}}),b.on("dragend",function(X){if(console.log("dragend"),this.resizing){this.resizing=!1;return}const st=X.event.zrX-bt,K=st<0?-1:1,_=Math.abs(st),Ot=_%u,kt=K*(Math.floor(_/u)+Math.floor(Ot/W)),Pt=X.event.zrY-n,Q=Math.floor(Pt/(g+y)),It=Q-v;d.start+=kt,mt&&Q!==v&&(p.splice(v,1),p.splice(Q>v?Q-1:Q,0,{...d})),(kt||It)&&I(),Y(null),R(!0)}),b.eachChild(function(X){X.attr({z:10})}),b.on("dblclick",function(){N.show();const X=document.querySelector("#current-task");X.value=JSON.stringify(p[this.index],null,2),X.dataset.index=this.index}),m.add(b)}),i&&gt===0&&p.length>0&&(console.log(p[0].start),L+=(p[0].start-f-1)*u,J.innerText,R(!0)),ht&&console.log({drawTaskBar:gt})}window.redrawChart=R;St?(document.title+=" (Remote)",Gt(m,R)):(nt&&zt("tasks",p.filter(t=>t.fillColor===nt)),R());
