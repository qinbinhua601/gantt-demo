(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();function qe(e){let n,r,i=!1;e.addEventListener("mousedown",function(t){e.style.position="absolute",!t.target.closest("#taskForm")&&(i=!0,n=t.clientX-e.getBoundingClientRect().left,r=t.clientY-e.getBoundingClientRect().top,document.body.style.userSelect="none")}),document.addEventListener("mousemove",function(t){if(i){const o=t.clientX-n,a=t.clientY-r;e.style.left=o+"px",e.style.top=a+"px"}}),document.addEventListener("mouseup",function(){i=!1,document.body.style.userSelect="auto"})}const T={};T.show=function({currentIndex:e}){if(!T.el){const t=document.querySelector(".popup-wrapper"),o=document.querySelector(".popup-wrapper__body"),a=t.querySelector("button.modify"),h=document.getElementById("name"),f=document.getElementById("resource"),s=document.getElementById("fillColor");qe(o),t.addEventListener("click",function(){T.hide()}),a.onclick=function(l){l.preventDefault();const c=T.index,w={...tasks[c],name:h.value,resource:f.value,fillColor:s.value};tasks.splice(c,1,w),syncLocal(),T.hide(),redrawChart(!0)},o.onclick=function(l){l.stopPropagation()},T.el=t,T.popupBody=o,T.formItems={name:h,resource:f,fillColor:s}}T.el.style.display="flex",T.index=e;const{name:n,resource:r,fillColor:i}=tasks[e];T.formItems.name.value=n,T.formItems.resource.value=r,T.formItems.fillColor.value=i};T.hide=function(){T.el.style.display="none",T.popupBody.removeAttribute("style")};function ve(e,n,r){if(e&&e.length){const[i,t]=n,o=Math.PI/180*r,a=Math.cos(o),h=Math.sin(o);for(const f of e){const[s,l]=f;f[0]=(s-i)*a-(l-t)*h+i,f[1]=(s-i)*h+(l-t)*a+t}}}function We(e,n,r){const i=[];e.forEach(t=>i.push(...t)),ve(i,n,r)}function je(e,n){return e[0]===n[0]&&e[1]===n[1]}function Xe(e,n,r,i=1){const t=r,o=Math.max(n,.1),a=e[0]&&e[0][0]&&typeof e[0][0]=="number"?[e]:e,h=[0,0];if(t)for(const s of a)ve(s,h,t);const f=_e(a,o,i);if(t){for(const s of a)ve(s,h,-t);We(f,h,-t)}return f}function _e(e,n,r){const i=[];for(const s of e){const l=[...s];je(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&i.push(l)}const t=[];n=Math.max(n,.1);const o=[];for(const s of i)for(let l=0;l<s.length-1;l++){const c=s[l],w=s[l+1];if(c[1]!==w[1]){const C=Math.min(c[1],w[1]);o.push({ymin:C,ymax:Math.max(c[1],w[1]),x:C===c[1]?c[0]:w[0],islope:(w[0]-c[0])/(w[1]-c[1])})}}if(o.sort((s,l)=>s.ymin<l.ymin?-1:s.ymin>l.ymin?1:s.x<l.x?-1:s.x>l.x?1:s.ymax===l.ymax?0:(s.ymax-l.ymax)/Math.abs(s.ymax-l.ymax)),!o.length)return t;let a=[],h=o[0].ymin,f=0;for(;a.length||o.length;){if(o.length){let s=-1;for(let c=0;c<o.length&&!(o[c].ymin>h);c++)s=c;o.splice(0,s+1).forEach(c=>{a.push({s:h,edge:c})})}if(a=a.filter(s=>!(s.edge.ymax<=h)),a.sort((s,l)=>s.edge.x===l.edge.x?0:(s.edge.x-l.edge.x)/Math.abs(s.edge.x-l.edge.x)),(r!==1||f%n===0)&&a.length>1)for(let s=0;s<a.length;s=s+2){const l=s+1;if(l>=a.length)break;const c=a[s].edge,w=a[l].edge;t.push([[Math.round(c.x),h],[Math.round(w.x),h]])}h+=r,a.forEach(s=>{s.edge.x=s.edge.x+r*s.edge.islope}),f++}return t}window.hachureLines=Xe;const Re={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"},"01-01":{holiday:!0,name:"元旦",wage:3,date:"2025-01-01",rest:13},"01-26":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2025-01-26",rest:22},"01-28":{holiday:!0,name:"除夕",wage:2,date:"2025-01-28",rest:24},"01-29":{holiday:!0,name:"初一",wage:3,date:"2025-01-29",rest:1},"01-30":{holiday:!0,name:"初二",wage:3,date:"2025-01-30",rest:1},"01-31":{holiday:!0,name:"初三",wage:3,date:"2025-01-31",rest:1},"02-01":{holiday:!0,name:"初四",wage:2,date:"2025-02-01",rest:1},"02-02":{holiday:!0,name:"初五",wage:2,date:"2025-02-02",rest:1},"02-03":{holiday:!0,name:"初六",wage:2,date:"2025-02-03",rest:1},"02-04":{holiday:!0,name:"初七",wage:2,date:"2025-02-04",rest:1},"02-08":{holiday:!1,name:"春节后补班",wage:1,target:"春节",after:!0,date:"2025-02-08",rest:4},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2025-04-04",rest:16},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2025-04-05",rest:1},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2025-04-06",rest:1},"04-27":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2025-04-27",rest:21},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-01",rest:25},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2025-05-02",rest:1},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-03",rest:1},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2025-05-05"},"05-31":{holiday:!0,name:"端午节",wage:3,date:"2025-05-31"},"06-01":{holiday:!0,name:"端午节",wage:2,date:"2025-06-01"},"06-02":{holiday:!0,name:"端午节",wage:2,date:"2025-06-02"},"09-28":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2025-09-28"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2025-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2025-10-02"},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2025-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-05"},"10-06":{holiday:!0,name:"中秋节",wage:2,date:"2025-10-06"},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-07"},"10-08":{holiday:!0,name:"国庆节",wage:2,date:"2025-10-08"},"10-11":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2025-10-11"}};function Be(e){const n=new Date(e),r=n.getMonth()+1+"",i=r.padStart(2,"0"),t=n.getDate()+"",o=t.padStart(2,"0"),a=`${i}-${o}`,h=[0,6].indexOf(n.getDay())!=-1;return Re[a]?{isHoliday:Re[a].holiday,dateString:`${r}-${t}`}:{isHoliday:h,dateString:`${r}-${t}`}}function b(e="unitWidth",n=!0){const r=new URLSearchParams(location.search);return r.get(e)&&n?Number(r.get(e)):r.get(e)}function Y(){ae||Je()||b("useLocal")&&Object.keys(he).forEach(e=>{const n=localStorage.getItem(e);try{localStorage.setItem(e,JSON.stringify(window[e]))}catch{console.error("fail to syncLocal"),localStorage.setItem(e,n)}})}window.syncLocal=Y;let pe=null;function Je(){if(b("useRemote")){const e={tasks:window.tasks,mileStones:window.mileStones};return pe&&clearTimeout(pe),pe=setTimeout(()=>{Ee(e).then(n=>{n.status===0&&console.log("recordUpdate成功",n)})},200),!0}return!1}const Ae=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Ee(e){return fetch(`${Ae}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:ue,...e})}).then(n=>n.json())}function Ue(){return console.log("current view",ue),fetch(`${Ae}/record/query${ue?`?view=${ue}`:""}`).then(e=>e.json())}const he={tasks:[{}],mileStones:[]};function $e(e="tasks"){try{return localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):he[e]}catch{return console.error("fail to getLocal"),he[e]}}function K(){const e=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),r=Math.floor(Math.random()*256);return"#"+e.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")+r.toString(16).padStart(2,"0")}function Ve(e,n){e.dom.style.opacity=0,Ue().then(r=>{const{data:i}=r;console.log(i),i!=null&&i.tasks||i!=null&&i.mileStones?(Se("tasks",i.tasks.filter(t=>ae?t.fillColor===ae:!0)),Se("mileStones",i.mileStones)):i||window.tasks.push({}),De(i==null?void 0:i.tasks),n(!0),e.dom.style.opacity=1})}function Ze(e){const n=e?{view:`${e}`}:{};Ee({tasks:window.tasks,mileStones:window.mileStones,...n})}window.saveToRemote=Ze;function Ke(e){Object.keys(he).forEach(n=>{const r=localStorage.getItem(n);try{localStorage.setItem(n,JSON.stringify(window[n]))}catch{console.error("fail to syncLocal"),localStorage.setItem(n,r)}})}window.saveToLocal=Ke;function Se(e,n){window[`old_${e}`]=[...window[e]],window[e].length=0,window[e].push(...n)}function Ce(e){var r;console.log(e.target);const n=new URLSearchParams(location.search);(r=e.target.dataset)!=null&&r.color?(e.target.dataset.hovered=!0,n.set("filter",e.target.dataset.color)):n.delete("filter"),location.href=`${location.pathname}?${n.toString()}`}function De(e){if(!me&&!Le||!He||!e)return;const n=e,r=document.querySelector("#color-picker");r.removeEventListener("click",Ce),r.addEventListener("click",Ce);const i=[...new Set(n.map(({fillColor:t})=>t)),""].filter(t=>t!==void 0).map(t=>`<div data-color="${t}" style="background-color: ${t};"></div>`);r.innerHTML=i.join("")}let v=null;const Q=e=>{v=e},ge=b("debug")??!1,Qe="alexq",u=b()??160,_=u/2,de=b("taskNamePaddingLeft")??15,Ge=1,et=50,B=b("timeScaleHeight")??20,oe=b("milestoneTopHeight")??20,g=b("barHeight")??30,y=ge?10:b("barMargin")??1,tt=b("scrollSpeed")??35,nt=b("includeHoliday")??!1,me=b("useLocal"),Le=b("useRemote"),ue=b("view",!1)??"",ot=!Le&&!me&&b("mockTaskSize")?Number(b("mockTaskSize")):0,j=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),fe=(j-1)*u,J=document.querySelector("#last-scroll-x");J.innerText=fe;const ae=b("filter",!1)??null,He=b("showFilter")??!1,A=g/3*2,Ie=b("showArrow")??!0,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function rt(e,n,r,i){const t=document.querySelector("#back-to-origin-button");t==null||t.addEventListener("click",function(){e(fe),n(0),r.innerText=fe,i(!0)});const o=document.querySelector("#clear-button");o==null||o.addEventListener("click",function(){const h=tasks.length;tasks.length=0;for(let f=0;f<h;f++)tasks.push({});Y(),i(!0)});const a=document.querySelector("#clear-milestone-button");a==null||a.addEventListener("click",function(){mileStones.length=0,Y(),i(!0)}),He&&De(window.tasks)}function at(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function it(e,n,r,i,t){const o=new zrender.Group,a=at(),{width:h,height:f}=a.getBoundingRect();a.attr({x:n+r-h/2,y:i-t+t/2-f/2});const s=new zrender.Circle({shape:{cx:n+r+1,cy:i-t+t/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return o.add(s),o.add(a),o.hide(),e.add(o),[o,{flag:a,flagHoveredCircle:s}]}function st(e,n,r,i){const{height:t,width:o}=r,a=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${ge?1:0})`,lineWidth:1},shape:{width:e,height:t},draggable:"horizontal",cursor:"ew-resize",z:1});a.attr({x:n.x,y:n.y,shape:{x:-e/2,y:0}});let h=0,f=0,s=0;return a.on("dragstart",function(l){this.parent.resizing=!0,h=l.event.zrX;const c=this.taskBar;s=c.shape.width,f=c.shape.x,Q(this.parent)}),a.on("drag",function(l){const c=l.event.zrX-h;this.taskBar.attr({shape:{x:f+c,width:s-c}})}),a.on("dragend",function(l){const c=l.event.zrX-h,w=c<0?-1:1,C=Math.abs(c),$=C%u,N=w*(Math.floor(C/u)+Math.floor($/_));console.log(N);const ie=tasks[this.parent.index];ie.start+=N,ie.duration-=N,N&&Y(),Q(null),i(!0)}),a}function lt(e,n,r,i){const{height:t,width:o}=r,a=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${ge?1:0})`,lineWidth:1},shape:{width:e,height:t},draggable:"horizontal",cursor:"ew-resize",z:1});a.attr({x:n.x+o,y:n.y,shape:{x:-e/2,y:0}});let h=0,f=0;return a.on("dragstart",function(s){this.parent.resizing=!0,h=s.event.zrX;const l=this.taskBar;f=l.shape.width,l.shape.x,console.log(v),Q(this.parent)}),a.on("drag",function(s){const l=s.event.zrX-h;this.taskBar.attr({shape:{width:f+l}})}),a.on("dragend",function(s){const l=s.event.zrX-h,c=l<0?-1:1,w=Math.abs(l),C=w%u,$=c*(Math.floor(w/u)+Math.floor(C/_)),N=tasks[this.parent.index];N.duration+=$,$&&Y(),Q(null),i(!0)}),a}const ct=+new Date("2024-01-01"),dt=60*60*24*1e3;function ut(e,n){const{start:r,duration:i}=e;if(n)return e.duration;let t=0;const o=i+r;for(let a=r;a<o;a++)Be(new Date(ct+dt*a)).isHoliday||t++;return t}function ht(e,n,r,i,t){return t<0||t>tasks.length-1?null:new zrender.Rect({shape:{x:e+r,y:n+(g+y)*t,width:i*u,height:1},style:{fill:"blue"},zlevel:1})}function ft(e,n,r,i,t,o,a){if(!Ie)return;const h=1e3,f=new zrender.Group({x:5,y:n+(i.height-A)/2}),s=new zrender.Text({x:A*.1,style:{text:"←",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:h+1,name:"leftArrowText"});f.add(s);const l=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:h,name:"leftArrowRect"});return f.on("mouseover",function(){o>=r.start+r.duration&&this.childOfName("leftArrowRect").attr({style:{fill:r.fillColor}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),f.on("mouseout",function(){this.childOfName("leftArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),f.on("click",a),f.add(l),t||f.eachChild(function(c){c.hide()}),f}function gt(e,n,r,i,t,o,a,h,f,s){if(!Ie)return;const l=1e3,c=new zrender.Group({x:e+t+o-A-10-r.start*i,y:n+(a.height-A)/2}),w=new zrender.Text({x:A*.1,style:{text:"→",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:l+1,name:"rightArrowText"});c.add(w);const C=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:l,name:"rightArrowRect"});return c.on("mouseover",function(){const $=this.childOfName("rightArrowRect");f<r.start&&$.attr({style:{fill:r.fillColor}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),c.on("mouseout",function(){this.childOfName("rightArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),c.on("click",s),c.add(C),h||c.eachChild(function($){$.hide()}),c}function mt(e,n,r,i,t,o,a){const h=new zrender.Rect({shape:{x:n+a*u-1+_,y:r,width:2,height:tasks.length*(t+o)},style:{fill:"#2955c9"},z:1}),f=new zrender.Circle({shape:{cx:n+a*u+_,cy:r-i+i+2,r:3},style:{fill:"#2955c9"}});e.add(h),e.add(f)}const M={};M.show=function({currentIndex:e,position:{x:n,y:r}}){var i;if(!M.el){const t=document.querySelector("#contextMenu"),o=t.querySelector(".menu-item.copy"),a=t.querySelector(".menu-item.delete");a.onclick=function(s){s.preventDefault();const l=Number(t.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(l,1),syncLocal()),M.hide(),redrawChart(!0)},o.onclick=function(s){s.preventDefault();const l=Number(t.dataset.index),c={...tasks[l],duration:1};tasks.splice(l+1,0,c),console.log(tasks[l]),syncLocal(),M.hide(),redrawChart(!0)},M.el=t;const{left:h,top:f}=((i=document.querySelector("#zrender-container"))==null?void 0:i.getBoundingClientRect())||{left:0,top:0};M.offsetX=h,M.offsetY=f}M.el.style.display="block",M.el.dataset.index=e,M.el.style.left=`${n+M.offsetX}px`,M.el.style.top=`${r+M.offsetY}px`};M.hide=function(){M.el&&(M.el.style.display="none")};let xe=null,z=0+fe;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),S=me?$e():[{name:"Task 1",start:j+0,duration:3,resource:"John",fillColor:K()},{name:"Task 2",start:j+2,duration:4,resource:"Jane",fillColor:K()},{name:"Task 3 long long long",start:j+7,duration:1,resource:"Bob",fillColor:K()},{name:"Task 4",start:j+8,duration:2,resource:"Bose",fillColor:K()},{name:"Task 5",start:j+10,duration:3,resource:"Uno",fillColor:K()},{}],yt=S.pop();for(;S.length>1&&S.length<ot;)S.push(...S.map(e=>({...e})));S.push(yt);window.tasks=S;const re=me?$e("mileStones"):[{start:10,name:"提测"}];window.mileStones=re;if(Ne){let e;m.dom.addEventListener("touchstart",function(n){v!=null&&v.resizing||v!=null&&v.dragging||(console.log(n),e=n.touches[0].clientX)}),m.dom.addEventListener("touchmove",function(n){if(v!=null&&v.resizing||v!=null&&v.dragging)return;n.preventDefault();let r=n.touches[0].clientX-e;e=n.touches[0].clientX,z-=Math.floor(r),X(!0,z,0),J.innerText=z})}else m.dom.addEventListener("click",function(){M.hide()}),m.on("mousewheel",function(e){e.event.preventDefault(),z-=Math.floor(e.event.wheelDeltaX*.01*tt),X(!0,z,0),J.innerText=z});window.addEventListener("resize",function(){m.resize(),X(!0)});rt(e=>z=e,e=>e,J,X);let ze=!0;function X(e=!1,n=z,r=0){const i=ze;ze&&(ze=!1);const t=Ge-n,o=Math.max(et,B+oe)-r;e&&m.clear();const a=m.getWidth(),h=m.getHeight(),f=Math.floor(z/u),s=Math.floor((z+a)/u);let l,c;function w(d){if(v!=null&&v.resizing||v!=null&&v.dragging)return;const k=d.event.zrX-t,E=d.event.zrY-o,x=Math.floor(k/u),p=Math.floor(E/(g+y));if(l!==[x,p].join())if(l=[x,p].join(),p>=0&&p<S.length){if(p!==S.length-1){c&&m.remove(c);return}const R=new zrender.Group;R.on("click",function(){console.log("dayHoverGroup clicked pos: ",[x,p]);const H=prompt("task name?");if(!H)return;const U=prompt("assign to who?")||Qe;S.splice(p,0,{name:H,start:x,duration:1,resource:U,fillColor:K()}),Y(),X(!0)});const O=new zrender.Rect({shape:{x:t+u*x+5,y:o+(g+y)*p,width:u-10,height:g+y},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),D=new zrender.Rect({shape:{x:t+z,y:o+(g+y)*p,width:u*C,height:g+y},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),q=new zrender.Line({shape:{x1:t+u*x+u/2-5,y1:o+(g+y)*p+(g+y)/2,x2:t+u*x+u/2+5,y2:o+(g+y)*p+(g+y)/2},style:{stroke:"gray"},z:100}),L=new zrender.Line({shape:{x1:t+u*x+u/2,y1:o+(g+y)*p+(g+y)/2-5,x2:t+u*x+u/2,y2:o+(g+y)*p+(g+y)/2+5},style:{stroke:"gray"},z:100});R.add(O),R.add(q),R.add(L),R.add(D),c&&m.remove(c),c=R,m.add(R)}else c&&m.remove(c)}xe&&m.off("mousemove",xe),xe=w,m.on("mousemove",w);const C=Math.ceil(a/u),$=new zrender.Rect({shape:{x:t+z,y:o-B,width:C*u,height:B},style:{fill:"rgba(255, 0,0, .2)"}});m.add($);const N=t,ie=C*u,be=C+1,Pe=Math.floor(z/u);for(let d=0+Pe,k=0;k<be;d++,k++){const E=Math.min(S.length,(h-o)/(g+y)),x=N+d*u,p=new zrender.Line({shape:{x1:x,y1:o-B,x2:x,y2:o+(g+y)*E},style:{stroke:"lightgray"}});if(k<be-1){const R=+new Date("2024-01-01")+d*60*1e3*60*24,O=Be(R);if(O.isHoliday)try{Xe([[t+d*u,o],[t+d*u+u,o],[t+d*u+u,o+(g+y)*E],[t+d*u,o+(g+y)*E]],10,45).forEach(F=>{const[se,ee]=F[0],[te,le]=F[1],ce=new zrender.Line({shape:{x1:se,y1:ee,x2:te,y2:le},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(ce)})}catch(P){console.log(P)}const D=new zrender.Text({style:{text:O.dateString,x,y:o-B},z:1}),[q,{flag:L}]=it(m,x,_,o,B);D.on("click",function(){console.log("date text click",d);const P=re.findIndex(F=>F.start===d);if(P===-1){if(confirm("Do you want to CREATE a milestone here?")){const F=prompt("mileStone name?");re.push({start:d,name:F}),Y()}}else confirm("Do you want to DELETE the milestone here?")&&(re.splice(P,1),Y());X(!0)}),D.on("mouseover",function(P){this.attr({style:{opacity:0}}),q.show()}),D.on("mouseout",function(P){this.attr({style:{opacity:1}}),q.hide()});const{width:H,height:U}=D.getBoundingRect();D.attr({style:{x:x-H/2+_,y:o-B-U/2+B/2}}),m.add(D)}m.add(p)}S.length+1;for(let d=0;d<1;d++){const k=o+d*(g+y),E=new zrender.Line({shape:{x1:t,y1:k,x2:ie+t,y2:k},style:{stroke:"lightgray"}});m.add(E)}mt(m,t,o,B,g,y,j),re.forEach(function(d){const k=new zrender.Rect({shape:{x:t+d.start*u-1,y:o-B,width:2,height:S.length*(g+y)+B},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),E=new zrender.Rect({shape:{x:t+d.start*u-1,y:o-B-oe,width:10,height:oe},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),x=new zrender.Text({style:{x:t+d.start*u-1+10,y:o-B-oe,text:d.name||"里程碑",fill:"white",lineHeight:oe,fontSize:12},z:1}),p=x.getBoundingRect();E.attr({shape:{width:p.width+10*2}}),m.add(k),m.add(E),m.add(x)});let ye=0;S.forEach(function(d,k){if(!(d!=null&&d.name)||k>Math.floor((h-o)/(g+y)))return;const E=d.start<=f,x=d.start+d.duration>s,p=t+d.start*u,G=o+(g+y)*k,R=d.duration*u,O={width:R,height:g},D=ft(p,G,d,O,E,f,function(){z=(d.start-3)*u,J.innerText=z,X(!0)}),q=gt(p,G,d,u,z,a,O,x,s,function(){z=(d.start+d.duration+3)*u-a,J.innerText=z,X(!0)});if(D&&m.add(D),q&&m.add(q),d.start>s||d.start+d.duration<f)return;ye++;const L=new zrender.Group({x:p,y:G,draggable:!Ne}),H=new zrender.Rect({shape:{x:0,y:0,width:R,height:g,r:6},style:{fill:d.fillColor},cursor:"move"});L.add(H),L.index=k;const U=6,P=H.getBoundingRect(),F=st(U,P,O,X);F.taskBar=H,L.add(F);const se=lt(U,P,O,X);se.taskBar=H,L.add(se),L.on("mouseover",function(){this.dragging||H.attr("style",{fill:zrender.color.lift(d.fillColor,.3)})}),L.on("mouseout",function(){this.dragging||this.resizing||H.attr("style",{fill:d.fillColor})});const ee=new zrender.Text({style:{text:d.name,x:de,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),te=new zrender.Text({style:{text:`${ut(d,nt)}天`,x:R-de,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:le}=te.getBoundingRect();te.attr({style:{x:R-le-de}});const ce=new zrender.Text({style:{text:"Assigned to: "+d.resource,x:0+R+5,y:g/2+0-12/2,textFill:"black"},cursor:"normal"});ee.getBoundingRect().width+le+de*2>R&&(ce.attr({style:{text:d.name}}),ee.hide()),L.add(ee),L.add(te),L.add(ce);let ke=0,Me=null,we=null;L.on("dragstart",function(I){this.resizing||(ke=I.event.zrX,Q(this))}),L.on("drag",function(I){if(this.resizing)return;const V=I.event.zrY-o,W=Math.floor(V/(g+y));if(Me!==W){Me=W,m.remove(we);const Z=ht(t,o,z,C,W);we=Z,Z&&m.add(Z),m.refresh()}}),L.on("dragend",function(I){if(this.isContextMenu){this.isContextMenu=!1;return}if(this.isDragging=!1,console.log("dragend"),this.resizing){this.resizing=!1;return}const V=I.event.zrX-ke,W=V<0?-1:1,Z=Math.abs(V),Oe=Z%u,Te=W*(Math.floor(Z/u)+Math.floor(Oe/_)),Fe=I.event.zrY-o,ne=Math.floor(Fe/(g+y)),Ye=ne-k;d.start+=Te,we&&ne!==k&&(S.splice(k,1),S.splice(ne>k?ne-1:ne,0,{...d})),(Te||Ye)&&Y(),Q(null),X(!0)}),L.eachChild(function(I){I.attr({z:10})}),L.on("dblclick",function(){T.show({currentIndex:this.index})}),L.on("contextmenu",function(I){this.isContextMenu=!0,I.event.preventDefault();const{zrX:V,zrY:W}=I.event;M.show({currentIndex:this.index,position:{x:V,y:W}})}),m.add(L)}),i&&ye===0&&S.length>0&&(console.log(S[0].start),z+=(S[0].start-f-1)*u,J.innerText,X(!0)),ge&&console.log({drawTaskBar:ye})}window.redrawChart=X;Le?(document.title+=" (Remote)",Ve(m,X)):(ae&&Se("tasks",S.filter(e=>e.fillColor===ae)),X());
