(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();function qt(t){let n,r,s=!1;t.addEventListener("mousedown",function(e){t.style.position="absolute",!e.target.closest("#taskForm")&&(s=!0,n=e.clientX-t.getBoundingClientRect().left,r=e.clientY-t.getBoundingClientRect().top,document.body.style.userSelect="none")}),document.addEventListener("mousemove",function(e){if(s){const o=e.clientX-n,a=e.clientY-r;t.style.left=o+"px",t.style.top=a+"px"}}),document.addEventListener("mouseup",function(){s=!1,document.body.style.userSelect="auto"})}const T={};T.show=function({currentIndex:t}){if(!T.el){const e=document.querySelector(".popup-wrapper"),o=document.querySelector(".popup-wrapper__body"),a=e.querySelector("button.modify"),f=document.getElementById("name"),h=document.getElementById("resource"),i=document.getElementById("fillColor");qt(o),e.addEventListener("click",function(){T.hide()}),a.onclick=function(l){l.preventDefault();const c=T.index,w={...tasks[c],name:f.value,resource:h.value,fillColor:i.value};tasks.splice(c,1,w),syncLocal(),T.hide(),redrawChart(!0)},o.onclick=function(l){l.stopPropagation()},T.el=e,T.popupBody=o,T.formItems={name:f,resource:h,fillColor:i}}T.el.style.display="flex",T.index=t;const{name:n,resource:r,fillColor:s}=tasks[t];T.formItems.name.value=n,T.formItems.resource.value=r,T.formItems.fillColor.value=s};T.hide=function(){T.el.style.display="none",T.popupBody.removeAttribute("style")};function vt(t,n,r){if(t&&t.length){const[s,e]=n,o=Math.PI/180*r,a=Math.cos(o),f=Math.sin(o);for(const h of t){const[i,l]=h;h[0]=(i-s)*a-(l-e)*f+s,h[1]=(i-s)*f+(l-e)*a+e}}}function Wt(t,n,r){const s=[];t.forEach(e=>s.push(...e)),vt(s,n,r)}function jt(t,n){return t[0]===n[0]&&t[1]===n[1]}function Xt(t,n,r,s=1){const e=r,o=Math.max(n,.1),a=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,f=[0,0];if(e)for(const i of a)vt(i,f,e);const h=_t(a,o,s);if(e){for(const i of a)vt(i,f,-e);Wt(h,f,-e)}return h}function _t(t,n,r){const s=[];for(const i of t){const l=[...i];jt(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&s.push(l)}const e=[];n=Math.max(n,.1);const o=[];for(const i of s)for(let l=0;l<i.length-1;l++){const c=i[l],w=i[l+1];if(c[1]!==w[1]){const C=Math.min(c[1],w[1]);o.push({ymin:C,ymax:Math.max(c[1],w[1]),x:C===c[1]?c[0]:w[0],islope:(w[0]-c[0])/(w[1]-c[1])})}}if(o.sort((i,l)=>i.ymin<l.ymin?-1:i.ymin>l.ymin?1:i.x<l.x?-1:i.x>l.x?1:i.ymax===l.ymax?0:(i.ymax-l.ymax)/Math.abs(i.ymax-l.ymax)),!o.length)return e;let a=[],f=o[0].ymin,h=0;for(;a.length||o.length;){if(o.length){let i=-1;for(let c=0;c<o.length&&!(o[c].ymin>f);c++)i=c;o.splice(0,i+1).forEach(c=>{a.push({s:f,edge:c})})}if(a=a.filter(i=>!(i.edge.ymax<=f)),a.sort((i,l)=>i.edge.x===l.edge.x?0:(i.edge.x-l.edge.x)/Math.abs(i.edge.x-l.edge.x)),(r!==1||h%n===0)&&a.length>1)for(let i=0;i<a.length;i=i+2){const l=i+1;if(l>=a.length)break;const c=a[i].edge,w=a[l].edge;e.push([[Math.round(c.x),f],[Math.round(w.x),f]])}f+=r,a.forEach(i=>{i.edge.x=i.edge.x+r*i.edge.islope}),h++}return e}window.hachureLines=Xt;const Rt={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"}};function Bt(t){const n=new Date(t),r=n.getMonth()+1+"",s=r.padStart(2,"0"),e=n.getDate()+"",o=e.padStart(2,"0"),a=`${s}-${o}`,f=[0,6].indexOf(n.getDay())!=-1;return Rt[a]?{isHoliday:Rt[a].holiday,dateString:`${r}-${e}`}:{isHoliday:f,dateString:`${r}-${e}`}}function b(t="unitWidth",n=!0){const r=new URLSearchParams(location.search);return r.get(t)&&n?Number(r.get(t)):r.get(t)}function Y(){at||Jt()||b("useLocal")&&Object.keys(ft).forEach(t=>{const n=localStorage.getItem(t);try{localStorage.setItem(t,JSON.stringify(window[t]))}catch{console.error("fail to syncLocal"),localStorage.setItem(t,n)}})}window.syncLocal=Y;let pt=null;function Jt(){if(b("useRemote")){const t={tasks:window.tasks,mileStones:window.mileStones};return pt&&clearTimeout(pt),pt=setTimeout(()=>{Et(t).then(n=>{n.status===0&&console.log("recordUpdate成功",n)})},200),!0}return!1}const At=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Et(t){return fetch(`${At}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:ut,...t})}).then(n=>n.json())}function Ut(){return console.log("current view",ut),fetch(`${At}/record/query${ut?`?view=${ut}`:""}`).then(t=>t.json())}const ft={tasks:[{}],mileStones:[]};function $t(t="tasks"){try{return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):ft[t]}catch{return console.error("fail to getLocal"),ft[t]}}function K(){const t=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),r=Math.floor(Math.random()*256);return"#"+t.toString(16).padStart(2,"0")+n.toString(16).padStart(2,"0")+r.toString(16).padStart(2,"0")}function Vt(t,n){t.dom.style.opacity=0,Ut().then(r=>{const{data:s}=r;console.log(s),s!=null&&s.tasks||s!=null&&s.mileStones?(St("tasks",s.tasks.filter(e=>at?e.fillColor===at:!0)),St("mileStones",s.mileStones)):s||window.tasks.push({}),Dt(s==null?void 0:s.tasks),n(!0),t.dom.style.opacity=1})}function Zt(t){const n=t?{view:`${t}`}:{};Et({tasks:window.tasks,mileStones:window.mileStones,...n})}window.saveToRemote=Zt;function Kt(t){Object.keys(ft).forEach(n=>{const r=localStorage.getItem(n);try{localStorage.setItem(n,JSON.stringify(window[n]))}catch{console.error("fail to syncLocal"),localStorage.setItem(n,r)}})}window.saveToLocal=Kt;function St(t,n){window[`old_${t}`]=[...window[t]],window[t].length=0,window[t].push(...n)}function Ct(t){var r;console.log(t.target);const n=new URLSearchParams(location.search);(r=t.target.dataset)!=null&&r.color?(t.target.dataset.hovered=!0,n.set("filter",t.target.dataset.color)):n.delete("filter"),location.href=`${location.pathname}?${n.toString()}`}function Dt(t){if(!mt&&!Lt||!Ht||!t)return;const n=t,r=document.querySelector("#color-picker");r.removeEventListener("click",Ct),r.addEventListener("click",Ct);const s=[...new Set(n.map(({fillColor:e})=>e)),""].filter(e=>e!==void 0).map(e=>`<div data-color="${e}" style="background-color: ${e};"></div>`);r.innerHTML=s.join("")}let S=null;const Q=t=>{S=t},gt=b("debug")??!1,Qt="alexq",u=b()??160,_=u/2,dt=b("taskNamePaddingLeft")??15,Gt=1,te=50,B=b("timeScaleHeight")??20,ot=b("milestoneTopHeight")??20,g=b("barHeight")??30,y=gt?10:b("barMargin")??1,ee=b("scrollSpeed")??35,ne=b("includeHoliday")??!1,mt=b("useLocal"),Lt=b("useRemote"),ut=b("view",!1)??"",oe=!Lt&&!mt&&b("mockTaskSize")?Number(b("mockTaskSize")):0,j=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),ht=(j-1)*u,J=document.querySelector("#last-scroll-x");J.innerText=ht;const at=b("filter",!1)??null,Ht=b("showFilter")??!1,A=g/3*2,It=b("showArrow")??!0,Nt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function re(t,n,r,s){const e=document.querySelector("#back-to-origin-button");e==null||e.addEventListener("click",function(){t(ht),n(0),r.innerText=ht,s(!0)});const o=document.querySelector("#clear-button");o==null||o.addEventListener("click",function(){const f=tasks.length;tasks.length=0;for(let h=0;h<f;h++)tasks.push({});Y(),s(!0)});const a=document.querySelector("#clear-milestone-button");a==null||a.addEventListener("click",function(){mileStones.length=0,Y(),s(!0)}),Ht&&Dt(window.tasks)}function ae(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function se(t,n,r,s,e){const o=new zrender.Group,a=ae(),{width:f,height:h}=a.getBoundingRect();a.attr({x:n+r-f/2,y:s-e+e/2-h/2});const i=new zrender.Circle({shape:{cx:n+r+1,cy:s-e+e/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return o.add(i),o.add(a),o.hide(),t.add(o),[o,{flag:a,flagHoveredCircle:i}]}function ie(t,n,r,s){const{height:e,width:o}=r,a=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${gt?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});a.attr({x:n.x,y:n.y,shape:{x:-t/2,y:0}});let f=0,h=0,i=0;return a.on("dragstart",function(l){this.parent.resizing=!0,f=l.event.zrX;const c=this.taskBar;i=c.shape.width,h=c.shape.x,Q(this.parent)}),a.on("drag",function(l){const c=l.event.zrX-f;this.taskBar.attr({shape:{x:h+c,width:i-c}})}),a.on("dragend",function(l){const c=l.event.zrX-f,w=c<0?-1:1,C=Math.abs(c),$=C%u,N=w*(Math.floor(C/u)+Math.floor($/_));console.log(N);const st=tasks[this.parent.index];st.start+=N,st.duration-=N,N&&Y(),Q(null),s(!0)}),a}function le(t,n,r,s){const{height:e,width:o}=r,a=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${gt?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});a.attr({x:n.x+o,y:n.y,shape:{x:-t/2,y:0}});let f=0,h=0;return a.on("dragstart",function(i){this.parent.resizing=!0,f=i.event.zrX;const l=this.taskBar;h=l.shape.width,l.shape.x,console.log(S),Q(this.parent)}),a.on("drag",function(i){const l=i.event.zrX-f;this.taskBar.attr({shape:{width:h+l}})}),a.on("dragend",function(i){const l=i.event.zrX-f,c=l<0?-1:1,w=Math.abs(l),C=w%u,$=c*(Math.floor(w/u)+Math.floor(C/_)),N=tasks[this.parent.index];N.duration+=$,$&&Y(),Q(null),s(!0)}),a}const ce=+new Date("2024-01-01"),de=60*60*24*1e3;function ue(t,n){const{start:r,duration:s}=t;if(n)return t.duration;let e=0;const o=s+r;for(let a=r;a<o;a++)Bt(new Date(ce+de*a)).isHoliday||e++;return e}function fe(t,n,r,s,e){return e<0||e>tasks.length-1?null:new zrender.Rect({shape:{x:t+r,y:n+(g+y)*e,width:s*u,height:1},style:{fill:"blue"},zlevel:1})}function he(t,n,r,s,e,o,a){if(!It)return;const f=1e3,h=new zrender.Group({x:5,y:n+(s.height-A)/2}),i=new zrender.Text({x:A*.1,style:{text:"←",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:f+1,name:"leftArrowText"});h.add(i);const l=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:f,name:"leftArrowRect"});return h.on("mouseover",function(){o>=r.start+r.duration&&this.childOfName("leftArrowRect").attr({style:{fill:r.fillColor}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),h.on("mouseout",function(){this.childOfName("leftArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),h.on("click",a),h.add(l),e||h.eachChild(function(c){c.hide()}),h}function ge(t,n,r,s,e,o,a,f,h,i){if(!It)return;const l=1e3,c=new zrender.Group({x:t+e+o-A-10-r.start*s,y:n+(a.height-A)/2}),w=new zrender.Text({x:A*.1,style:{text:"→",fill:"rgb(101, 116, 114)",fontSize:A*.8,textAlign:"center",lineHeight:A},z:l+1,name:"rightArrowText"});c.add(w);const C=new zrender.Rect({shape:{width:A,height:A,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:l,name:"rightArrowRect"});return c.on("mouseover",function(){const $=this.childOfName("rightArrowRect");h<r.start&&$.attr({style:{fill:r.fillColor}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),c.on("mouseout",function(){this.childOfName("rightArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),c.on("click",i),c.add(C),f||c.eachChild(function($){$.hide()}),c}function me(t,n,r,s,e,o,a){const f=new zrender.Rect({shape:{x:n+a*u-1+_,y:r,width:2,height:tasks.length*(e+o)},style:{fill:"#2955c9"},z:1}),h=new zrender.Circle({shape:{cx:n+a*u+_,cy:r-s+s+2,r:3},style:{fill:"#2955c9"}});t.add(f),t.add(h)}const M={};M.show=function({currentIndex:t,position:{x:n,y:r}}){var s;if(!M.el){const e=document.querySelector("#contextMenu"),o=e.querySelector(".menu-item.copy"),a=e.querySelector(".menu-item.delete");a.onclick=function(i){i.preventDefault();const l=Number(e.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(l,1),syncLocal()),M.hide(),redrawChart(!0)},o.onclick=function(i){i.preventDefault();const l=Number(e.dataset.index),c={...tasks[l],duration:1};tasks.splice(l+1,0,c),console.log(tasks[l]),syncLocal(),M.hide(),redrawChart(!0)},M.el=e;const{left:f,top:h}=((s=document.querySelector("#zrender-container"))==null?void 0:s.getBoundingClientRect())||{left:0,top:0};M.offsetX=f,M.offsetY=h}M.el.style.display="block",M.el.dataset.index=t,M.el.style.left=`${n+M.offsetX}px`,M.el.style.top=`${r+M.offsetY}px`};M.hide=function(){M.el&&(M.el.style.display="none")};let xt=null,v=0+ht;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),z=mt?$t():[{name:"Task 1",start:j+0,duration:3,resource:"John",fillColor:K()},{name:"Task 2",start:j+2,duration:4,resource:"Jane",fillColor:K()},{name:"Task 3 long long long",start:j+7,duration:1,resource:"Bob",fillColor:K()},{name:"Task 4",start:j+8,duration:2,resource:"Bose",fillColor:K()},{name:"Task 5",start:j+10,duration:3,resource:"Uno",fillColor:K()},{}],ye=z.pop();for(;z.length>1&&z.length<oe;)z.push(...z.map(t=>({...t})));z.push(ye);window.tasks=z;const rt=mt?$t("mileStones"):[{start:10,name:"提测"}];window.mileStones=rt;if(Nt){let t;m.dom.addEventListener("touchstart",function(n){S!=null&&S.resizing||S!=null&&S.dragging||(console.log(n),t=n.touches[0].clientX)}),m.dom.addEventListener("touchmove",function(n){if(S!=null&&S.resizing||S!=null&&S.dragging)return;n.preventDefault();let r=n.touches[0].clientX-t;t=n.touches[0].clientX,v-=Math.floor(r),X(!0,v,0),J.innerText=v})}else m.dom.addEventListener("click",function(){M.hide()}),m.on("mousewheel",function(t){t.event.preventDefault(),v-=Math.floor(t.event.wheelDeltaX*.01*ee),X(!0,v,0),J.innerText=v});window.addEventListener("resize",function(){m.resize(),X(!0)});re(t=>v=t,t=>t,J,X);let zt=!0;function X(t=!1,n=v,r=0){const s=zt;zt&&(zt=!1);const e=Gt-n,o=Math.max(te,B+ot)-r;t&&m.clear();const a=m.getWidth(),f=m.getHeight(),h=Math.floor(v/u),i=Math.floor((v+a)/u);let l,c;function w(d){if(S!=null&&S.resizing||S!=null&&S.dragging)return;const k=d.event.zrX-e,E=d.event.zrY-o,x=Math.floor(k/u),p=Math.floor(E/(g+y));if(l!==[x,p].join())if(l=[x,p].join(),p>=0&&p<z.length){if(x>=z[p].start&&x<z[p].start+z[p].duration){c&&m.remove(c);return}const R=new zrender.Group;R.on("click",function(){console.log("dayHoverGroup clicked pos: ",[x,p]);const H=prompt("task name?");if(!H)return;const U=prompt("assign to who?")||Qt;z.splice(p,0,{name:H,start:x,duration:1,resource:U,fillColor:K()}),Y(),X(!0)});const O=new zrender.Rect({shape:{x:e+u*x+5,y:o+(g+y)*p,width:u-10,height:g+y},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),D=new zrender.Rect({shape:{x:e+v,y:o+(g+y)*p,width:u*C,height:g+y},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),q=new zrender.Line({shape:{x1:e+u*x+u/2-5,y1:o+(g+y)*p+(g+y)/2,x2:e+u*x+u/2+5,y2:o+(g+y)*p+(g+y)/2},style:{stroke:"gray"},z:100}),L=new zrender.Line({shape:{x1:e+u*x+u/2,y1:o+(g+y)*p+(g+y)/2-5,x2:e+u*x+u/2,y2:o+(g+y)*p+(g+y)/2+5},style:{stroke:"gray"},z:100});R.add(O),R.add(q),R.add(L),R.add(D),c&&m.remove(c),c=R,m.add(R)}else c&&m.remove(c)}xt&&m.off("mousemove",xt),xt=w,m.on("mousemove",w);const C=Math.ceil(a/u),$=new zrender.Rect({shape:{x:e+v,y:o-B,width:C*u,height:B},style:{fill:"rgba(255, 0,0, .2)"}});m.add($);const N=e,st=C*u,bt=C+1,Pt=Math.floor(v/u);for(let d=0+Pt,k=0;k<bt;d++,k++){const E=Math.min(z.length,(f-o)/(g+y)),x=N+d*u,p=new zrender.Line({shape:{x1:x,y1:o-B,x2:x,y2:o+(g+y)*E},style:{stroke:"lightgray"}});if(k<bt-1){const R=+new Date("2024-01-01")+d*60*1e3*60*24,O=Bt(R);if(O.isHoliday)try{Xt([[e+d*u,o],[e+d*u+u,o],[e+d*u+u,o+(g+y)*E],[e+d*u,o+(g+y)*E]],10,45).forEach(F=>{const[it,tt]=F[0],[et,lt]=F[1],ct=new zrender.Line({shape:{x1:it,y1:tt,x2:et,y2:lt},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(ct)})}catch(P){console.log(P)}const D=new zrender.Text({style:{text:O.dateString,x,y:o-B},z:1}),[q,{flag:L}]=se(m,x,_,o,B);D.on("click",function(){console.log("date text click",d);const P=rt.findIndex(F=>F.start===d);if(P===-1){if(confirm("Do you want to CREATE a milestone here?")){const F=prompt("mileStone name?");rt.push({start:d,name:F}),Y()}}else confirm("Do you want to DELETE the milestone here?")&&(rt.splice(P,1),Y());X(!0)}),D.on("mouseover",function(P){this.attr({style:{opacity:0}}),q.show()}),D.on("mouseout",function(P){this.attr({style:{opacity:1}}),q.hide()});const{width:H,height:U}=D.getBoundingRect();D.attr({style:{x:x-H/2+_,y:o-B-U/2+B/2}}),m.add(D)}m.add(p)}z.length+1;for(let d=0;d<1;d++){const k=o+d*(g+y),E=new zrender.Line({shape:{x1:e,y1:k,x2:st+e,y2:k},style:{stroke:"lightgray"}});m.add(E)}me(m,e,o,B,g,y,j),rt.forEach(function(d){const k=new zrender.Rect({shape:{x:e+d.start*u-1,y:o-B,width:2,height:z.length*(g+y)+B},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),E=new zrender.Rect({shape:{x:e+d.start*u-1,y:o-B-ot,width:10,height:ot},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),x=new zrender.Text({style:{x:e+d.start*u-1+10,y:o-B-ot,text:d.name||"里程碑",fill:"white",lineHeight:ot,fontSize:12},z:1}),p=x.getBoundingRect();E.attr({shape:{width:p.width+10*2}}),m.add(k),m.add(E),m.add(x)});let yt=0;z.forEach(function(d,k){if(!(d!=null&&d.name)||k>Math.floor((f-o)/(g+y)))return;const E=d.start<=h,x=d.start+d.duration>i,p=e+d.start*u,G=o+(g+y)*k,R=d.duration*u,O={width:R,height:g},D=he(p,G,d,O,E,h,function(){v=(d.start-3)*u,J.innerText=v,X(!0)}),q=ge(p,G,d,u,v,a,O,x,i,function(){v=(d.start+d.duration+3)*u-a,J.innerText=v,X(!0)});if(D&&m.add(D),q&&m.add(q),d.start>i||d.start+d.duration<h)return;yt++;const L=new zrender.Group({x:p,y:G,draggable:!Nt}),H=new zrender.Rect({shape:{x:0,y:0,width:R,height:g,r:6},style:{fill:d.fillColor},cursor:"move"});L.add(H),L.index=k;const U=6,P=H.getBoundingRect(),F=ie(U,P,O,X);F.taskBar=H,L.add(F);const it=le(U,P,O,X);it.taskBar=H,L.add(it),L.on("mouseover",function(){this.dragging||H.attr("style",{fill:zrender.color.lift(d.fillColor,.3)})}),L.on("mouseout",function(){this.dragging||this.resizing||H.attr("style",{fill:d.fillColor})});const tt=new zrender.Text({style:{text:d.name,x:dt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),et=new zrender.Text({style:{text:`${ue(d,ne)}天`,x:R-dt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:lt}=et.getBoundingRect();et.attr({style:{x:R-lt-dt}});const ct=new zrender.Text({style:{text:"Assigned to: "+d.resource,x:0+R+5,y:g/2+0-12/2,textFill:"black"},cursor:"normal"});tt.getBoundingRect().width+lt+dt*2>R&&(ct.attr({style:{text:d.name}}),tt.hide()),L.add(tt),L.add(et),L.add(ct);let kt=0,Mt=null,wt=null;L.on("dragstart",function(I){this.resizing||(kt=I.event.zrX,Q(this))}),L.on("drag",function(I){if(this.resizing)return;const V=I.event.zrY-o,W=Math.floor(V/(g+y));if(Mt!==W){Mt=W,m.remove(wt);const Z=fe(e,o,v,C,W);wt=Z,Z&&m.add(Z),m.refresh()}}),L.on("dragend",function(I){if(this.isContextMenu){this.isContextMenu=!1;return}if(this.isDragging=!1,console.log("dragend"),this.resizing){this.resizing=!1;return}const V=I.event.zrX-kt,W=V<0?-1:1,Z=Math.abs(V),Ot=Z%u,Tt=W*(Math.floor(Z/u)+Math.floor(Ot/_)),Ft=I.event.zrY-o,nt=Math.floor(Ft/(g+y)),Yt=nt-k;d.start+=Tt,wt&&nt!==k&&(z.splice(k,1),z.splice(nt>k?nt-1:nt,0,{...d})),(Tt||Yt)&&Y(),Q(null),X(!0)}),L.eachChild(function(I){I.attr({z:10})}),L.on("dblclick",function(){T.show({currentIndex:this.index})}),L.on("contextmenu",function(I){this.isContextMenu=!0,I.event.preventDefault();const{zrX:V,zrY:W}=I.event;M.show({currentIndex:this.index,position:{x:V,y:W}})}),m.add(L)}),s&&yt===0&&z.length>0&&(console.log(z[0].start),v+=(z[0].start-h-1)*u,J.innerText,X(!0)),gt&&console.log({drawTaskBar:yt})}window.redrawChart=X;Lt?(document.title+=" (Remote)",Vt(m,X)):(at&&St("tasks",z.filter(t=>t.fillColor===at)),X());
