(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const N={};N.show=function(){if(!N.el){const t=document.querySelector(".popup-wrapper"),o=document.querySelector(".popup-wrapper__body"),a=t.querySelector("button.modify"),i=t.querySelector("button.delete"),e=t.querySelector("button.copy");t.addEventListener("click",function(){N.hide()}),a.onclick=function(n){n.preventDefault();const r=this.parentElement.previousElementSibling.value,u=Number(this.parentElement.previousElementSibling.dataset.index);tasks.splice(u,1,JSON.parse(r)),syncLocal(),N.hide(),redrawChart(!0)},i.onclick=function(n){n.preventDefault();const r=Number(this.parentElement.previousElementSibling.dataset.index);confirm("Are you sure to DELETE the task?")&&(tasks.splice(r,1),syncLocal()),N.hide(),redrawChart(!0)},e.onclick=function(n){n.preventDefault();const r=Number(this.parentElement.previousElementSibling.dataset.index),u={...tasks[r],duration:1};tasks.splice(r+1,0,u),console.log(tasks[r]),syncLocal(),N.hide(),redrawChart(!0)},o.onclick=function(n){n.stopPropagation()},N.el=t}N.el.style.display="flex"};N.hide=function(){N.el.style.display="none"};function xt(t,o,a){if(t&&t.length){const[i,e]=o,n=Math.PI/180*a,r=Math.cos(n),u=Math.sin(n);for(const f of t){const[s,l]=f;f[0]=(s-i)*r-(l-e)*u+i,f[1]=(s-i)*u+(l-e)*r+e}}}function qt(t,o,a){const i=[];t.forEach(e=>i.push(...e)),xt(i,o,a)}function Wt(t,o){return t[0]===o[0]&&t[1]===o[1]}function Rt(t,o,a,i=1){const e=a,n=Math.max(o,.1),r=t[0]&&t[0][0]&&typeof t[0][0]=="number"?[t]:t,u=[0,0];if(e)for(const s of r)xt(s,u,e);const f=jt(r,n,i);if(e){for(const s of r)xt(s,u,-e);qt(f,u,-e)}return f}function jt(t,o,a){const i=[];for(const s of t){const l=[...s];Wt(l[0],l[l.length-1])||l.push([l[0][0],l[0][1]]),l.length>2&&i.push(l)}const e=[];o=Math.max(o,.1);const n=[];for(const s of i)for(let l=0;l<s.length-1;l++){const c=s[l],z=s[l+1];if(c[1]!==z[1]){const M=Math.min(c[1],z[1]);n.push({ymin:M,ymax:Math.max(c[1],z[1]),x:M===c[1]?c[0]:z[0],islope:(z[0]-c[0])/(z[1]-c[1])})}}if(n.sort((s,l)=>s.ymin<l.ymin?-1:s.ymin>l.ymin?1:s.x<l.x?-1:s.x>l.x?1:s.ymax===l.ymax?0:(s.ymax-l.ymax)/Math.abs(s.ymax-l.ymax)),!n.length)return e;let r=[],u=n[0].ymin,f=0;for(;r.length||n.length;){if(n.length){let s=-1;for(let c=0;c<n.length&&!(n[c].ymin>u);c++)s=c;n.splice(0,s+1).forEach(c=>{r.push({s:u,edge:c})})}if(r=r.filter(s=>!(s.edge.ymax<=u)),r.sort((s,l)=>s.edge.x===l.edge.x?0:(s.edge.x-l.edge.x)/Math.abs(s.edge.x-l.edge.x)),(a!==1||f%o===0)&&r.length>1)for(let s=0;s<r.length;s=s+2){const l=s+1;if(l>=r.length)break;const c=r[s].edge,z=r[l].edge;e.push([[Math.round(c.x),u],[Math.round(z.x),u]])}u+=a,r.forEach(s=>{s.edge.x=s.edge.x+a*s.edge.islope}),f++}return e}window.hachureLines=Rt;const Tt={"01-01":{holiday:!0,name:"元旦",wage:3,date:"2024-01-01",rest:1},"02-04":{holiday:!1,name:"春节前补班",wage:1,after:!1,target:"春节",date:"2024-02-04",rest:34},"02-10":{holiday:!0,name:"初一",wage:3,date:"2024-02-10",rest:40},"02-11":{holiday:!0,name:"初二",wage:3,date:"2024-02-11"},"02-12":{holiday:!0,name:"初三",wage:3,date:"2024-02-12"},"02-13":{holiday:!0,name:"初四",wage:2,date:"2024-02-13"},"02-14":{holiday:!0,name:"初五",wage:2,date:"2024-02-14"},"02-15":{holiday:!0,name:"初六",wage:2,date:"2024-02-15"},"02-16":{holiday:!0,name:"初七",wage:2,date:"2024-02-16"},"02-17":{holiday:!0,name:"初八",wage:2,date:"2024-02-17"},"02-18":{holiday:!1,name:"春节后补班",wage:1,after:!0,target:"春节",date:"2024-02-18"},"04-04":{holiday:!0,name:"清明节",wage:3,date:"2024-04-04",rest:46},"04-05":{holiday:!0,name:"清明节",wage:2,date:"2024-04-05"},"04-06":{holiday:!0,name:"清明节",wage:2,date:"2024-04-06"},"04-07":{holiday:!1,name:"清明节后补班",wage:1,target:"清明节",after:!0,date:"2024-04-07"},"04-28":{holiday:!1,name:"劳动节前补班",wage:1,target:"劳动节",after:!1,date:"2024-04-28"},"05-01":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-01"},"05-02":{holiday:!0,name:"劳动节",wage:2,date:"2024-05-02"},"05-03":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-03"},"05-04":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-04"},"05-05":{holiday:!0,name:"劳动节",wage:3,date:"2024-05-05"},"05-11":{holiday:!1,name:"劳动节后补班",after:!0,wage:1,target:"劳动节",date:"2024-05-11"},"06-08":{holiday:!0,name:"端午节",wage:2,date:"2024-06-08"},"06-09":{holiday:!0,name:"端午节",wage:2,date:"2024-06-09"},"06-10":{holiday:!0,name:"端午节",wage:3,date:"2024-06-10"},"09-14":{holiday:!1,name:"中秋节前补班",after:!1,wage:1,target:"中秋节",date:"2024-09-14"},"09-15":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-15"},"09-16":{holiday:!0,name:"中秋节",wage:2,date:"2024-09-16"},"09-17":{holiday:!0,name:"中秋节",wage:3,date:"2024-09-17"},"09-29":{holiday:!1,name:"国庆节前补班",after:!1,wage:1,target:"国庆节",date:"2024-09-29"},"10-01":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-01"},"10-02":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-02",rest:1},"10-03":{holiday:!0,name:"国庆节",wage:3,date:"2024-10-03"},"10-04":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-04"},"10-05":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-05"},"10-06":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-06",rest:1},"10-07":{holiday:!0,name:"国庆节",wage:2,date:"2024-10-07",rest:1},"10-12":{holiday:!1,after:!0,wage:1,name:"国庆节后补班",target:"国庆节",date:"2024-10-12"}};function At(t){const o=new Date(t),a=o.getMonth()+1+"",i=a.padStart(2,"0"),e=o.getDate()+"",n=e.padStart(2,"0"),r=`${i}-${n}`,u=[0,6].indexOf(o.getDay())!=-1;return Tt[r]?{isHoliday:Tt[r].holiday,dateString:`${a}-${e}`}:{isHoliday:u,dateString:`${a}-${e}`}}function b(t="unitWidth",o=!0){const a=new URLSearchParams(location.search);return a.get(t)&&o?Number(a.get(t)):a.get(t)}function F(){nt||_t()||b("useLocal")&&Object.keys(dt).forEach(t=>{const o=localStorage.getItem(t);try{localStorage.setItem(t,JSON.stringify(window[t]))}catch{console.error("fail to syncLocal"),localStorage.setItem(t,o)}})}window.syncLocal=F;let yt=null;function _t(){if(b("useRemote")){const t={tasks:window.tasks,mileStones:window.mileStones};return yt&&clearTimeout(yt),yt=setTimeout(()=>{Ct(t).then(o=>{o.status===0&&console.log("recordUpdate成功",o)})},200),!0}return!1}const Et=localStorage.getItem("remoteHost")?localStorage.getItem("remoteHost"):"http://localhost:3004";function Ct(t){return fetch(`${Et}/record/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({view:ct,...t})}).then(o=>o.json())}function Jt(){return console.log("current view",ct),fetch(`${Et}/record/query${ct?`?view=${ct}`:""}`).then(t=>t.json())}const dt={tasks:[{}],mileStones:[]};function Xt(t="tasks"){try{return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):dt[t]}catch{return console.error("fail to getLocal"),dt[t]}}function Y(){const t=Math.floor(Math.random()*256),o=Math.floor(Math.random()*256),a=Math.floor(Math.random()*256);return"#"+t.toString(16).padStart(2,"0")+o.toString(16).padStart(2,"0")+a.toString(16).padStart(2,"0")}function Yt(t,o){t.dom.style.opacity=0,Jt().then(a=>{const{data:i}=a;console.log(i),i!=null&&i.tasks||i!=null&&i.mileStones?(zt("tasks",i.tasks.filter(e=>nt?e.fillColor===nt:!0)),zt("mileStones",i.mileStones)):i||window.tasks.push({}),Bt(i==null?void 0:i.tasks),o(!0),t.dom.style.opacity=1})}function Ut(t){const o=t?{view:`${t}`}:{};Ct({tasks:window.tasks,mileStones:window.mileStones,...o})}window.saveToRemote=Ut;function Vt(t){Object.keys(dt).forEach(o=>{const a=localStorage.getItem(o);try{localStorage.setItem(o,JSON.stringify(window[o]))}catch{console.error("fail to syncLocal"),localStorage.setItem(o,a)}})}window.saveToLocal=Vt;function zt(t,o){window[`old_${t}`]=[...window[t]],window[t].length=0,window[t].push(...o)}function Mt(t){var a;console.log(t.target);const o=new URLSearchParams(location.search);(a=t.target.dataset)!=null&&a.color?(t.target.dataset.hovered=!0,o.set("filter",t.target.dataset.color)):o.delete("filter"),location.href=`${location.pathname}?${o.toString()}`}function Bt(t){if(!ft&&!St||!Dt||!t)return;const o=t,a=document.querySelector("#color-picker");a.removeEventListener("click",Mt),a.addEventListener("click",Mt);const i=[...new Set(o.map(({fillColor:e})=>e)),""].filter(e=>e!==void 0).map(e=>`<div data-color="${e}" style="background-color: ${e};"></div>`);a.innerHTML=i.join("")}let v=null;const U=t=>{v=t},ut=b("debug")??!1,Zt="alexq",h=b()??160,W=h/2,lt=b("taskNamePaddingLeft")??15,Kt=1,Qt=50,A=b("timeScaleHeight")??20,tt=b("milestoneTopHeight")??20,g=b("barHeight")??30,y=ut?10:b("barMargin")??1,Gt=b("scrollSpeed")??35,te=b("includeHoliday")??!1,ft=b("useLocal"),St=b("useRemote"),ct=b("view",!1)??"",ee=!St&&!ft&&b("mockTaskSize")?Number(b("mockTaskSize")):0,Ht=Math.floor((+new Date-+new Date("2024-01-01"))/(60*60*24*1e3)),ht=(Ht-1)*h,j=document.querySelector("#last-scroll-x");j.innerText=ht;const nt=b("filter",!1)??null,Dt=b("showFilter")??!1,E=g/3*2,Nt=b("showArrow")??!0,$t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function ne(t,o,a,i){const e=document.querySelector("#back-to-origin-button");e==null||e.addEventListener("click",function(){t(ht),o(0),a.innerText=ht,i(!0)});const n=document.querySelector("#clear-button");n==null||n.addEventListener("click",function(){const u=tasks.length;tasks.length=0;for(let f=0;f<u;f++)tasks.push({});F(),i(!0)});const r=document.querySelector("#clear-milestone-button");r==null||r.addEventListener("click",function(){mileStones.length=0,F(),i(!0)}),Dt&&Bt(window.tasks)}function oe(){return zrender.path.createFromString("M3.333,10v 5 c0,0.184 -0.149, 0.333 -0.333, 0.333 h-0.667A0.333, 0.333 0 0 1 2, 15 V 1.333 c0, -0.368 0.298, -0.666 0.667, -0.666 h 11.525 a 0.667, 0.667 0 0 1 0.581, 0.994 L 12.76, 5.233 a 0.333, 0.333 0 0 0 0.002, 0.33 L 14.753, 9 A 0.667, 0.667 0 0 1 14.176, 10 H 3.333z",{style:{fill:"#F54A45"}})}function re(t,o,a,i,e){const n=new zrender.Group,r=oe(),{width:u,height:f}=r.getBoundingRect();r.attr({x:o+a-u/2,y:i-e+e/2-f/2});const s=new zrender.Circle({shape:{cx:o+a+1,cy:i-e+e/2,r:12},style:{fill:"rgba(211, 211, 211, 0.5)"}});return n.add(s),n.add(r),n.hide(),t.add(n),[n,{flag:r,flagHoveredCircle:s}]}function ae(t,o,a,i){const{height:e,width:n}=a,r=new zrender.Rect({name:"leftBar",style:{fill:`rgba(0, 255, 0, ${ut?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:o.x,y:o.y,shape:{x:-t/2,y:0}});let u=0,f=0,s=0;return r.on("dragstart",function(l){this.parent.resizing=!0,u=l.event.zrX;const c=this.taskBar;s=c.shape.width,f=c.shape.x,U(this.parent)}),r.on("drag",function(l){const c=l.event.zrX-u;this.taskBar.attr({shape:{x:f+c,width:s-c}})}),r.on("dragend",function(l){const c=l.event.zrX-u,z=c<0?-1:1,M=Math.abs(c),X=M%h,$=z*(Math.floor(M/h)+Math.floor(X/W));console.log($);const ot=tasks[this.parent.index];ot.start+=$,ot.duration-=$,$&&F(),U(null),i(!0)}),r}function ie(t,o,a,i){const{height:e,width:n}=a,r=new zrender.Rect({style:{fill:`rgba(255, 192, 203, ${ut?1:0})`,lineWidth:1},shape:{width:t,height:e},draggable:"horizontal",cursor:"ew-resize",z:1});r.attr({x:o.x+n,y:o.y,shape:{x:-t/2,y:0}});let u=0,f=0;return r.on("dragstart",function(s){this.parent.resizing=!0,u=s.event.zrX;const l=this.taskBar;f=l.shape.width,l.shape.x,console.log(v),U(this.parent)}),r.on("drag",function(s){const l=s.event.zrX-u;this.taskBar.attr({shape:{width:f+l}})}),r.on("dragend",function(s){const l=s.event.zrX-u,c=l<0?-1:1,z=Math.abs(l),M=z%h,X=c*(Math.floor(z/h)+Math.floor(M/W)),$=tasks[this.parent.index];$.duration+=X,X&&F(),U(null),i(!0)}),r}const se=+new Date("2024-01-01"),le=60*60*24*1e3;function ce(t,o){const{start:a,duration:i}=t;if(o)return t.duration;let e=0;const n=i+a;for(let r=a;r<n;r++)At(new Date(se+le*r)).isHoliday||e++;return e}function de(t,o,a,i,e){return e<0||e>tasks.length-1?null:new zrender.Rect({shape:{x:t+a,y:o+(g+y)*e,width:i*h,height:1},style:{fill:"blue"},zlevel:1})}function he(t,o,a,i,e,n,r){if(!Nt)return;const u=1e3,f=new zrender.Group({x:5,y:o+(i.height-E)/2}),s=new zrender.Text({x:E*.1,style:{text:"←",fill:"rgb(101, 116, 114)",fontSize:E*.8,textAlign:"center",lineHeight:E},z:u+1,name:"leftArrowText"});f.add(s);const l=new zrender.Rect({shape:{width:E,height:E,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:u,name:"leftArrowRect"});return f.on("mouseover",function(){n>=a.start+a.duration&&this.childOfName("leftArrowRect").attr({style:{fill:a.fillColor}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),f.on("mouseout",function(){this.childOfName("leftArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("leftArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),f.on("click",r),f.add(l),e||f.eachChild(function(c){c.hide()}),f}function ue(t,o,a,i,e,n,r,u,f,s){if(!Nt)return;const l=1e3,c=new zrender.Group({x:t+e+n-E-10-a.start*i,y:o+(r.height-E)/2}),z=new zrender.Text({x:E*.1,style:{text:"→",fill:"rgb(101, 116, 114)",fontSize:E*.8,textAlign:"center",lineHeight:E},z:l+1,name:"rightArrowText"});c.add(z);const M=new zrender.Rect({shape:{width:E,height:E,r:3},style:{fill:"rgba(221, 221, 221, 1)"},z:l,name:"rightArrowRect"});return c.on("mouseover",function(){const X=this.childOfName("rightArrowRect");f<a.start&&X.attr({style:{fill:a.fillColor}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(32, 35, 40)"}})}),c.on("mouseout",function(){this.childOfName("rightArrowRect").attr({style:{fill:"rgba(221, 221, 221, 1)"}}),this.childOfName("rightArrowText").attr({style:{fill:"rgb(101, 116, 114)"}})}),c.on("click",s),c.add(M),u||c.eachChild(function(X){X.hide()}),c}function fe(t,o,a,i,e,n,r){const u=new zrender.Rect({shape:{x:o+r*h-1+W,y:a,width:2,height:tasks.length*(e+n)},style:{fill:"#2955c9"},z:1}),f=new zrender.Circle({shape:{cx:o+r*h+W,cy:a-i+i+2,r:3},style:{fill:"#2955c9"}});t.add(u),t.add(f)}let wt=null,S=0+ht;const m=zrender.init(document.getElementById("zrender-container"),{renderer:"canvas"}),p=ft?Xt():[{name:"Task 1",start:0,duration:3,resource:"John",fillColor:Y()},{name:"Task 2",start:2,duration:4,resource:"Jane",fillColor:Y()},{name:"Task 3 long long long",start:7,duration:1,resource:"Bob",fillColor:Y()},{name:"Task 4",start:8,duration:2,resource:"Bose",fillColor:Y()},{name:"Task 5",start:10,duration:3,resource:"Uno",fillColor:Y()},{}],ge=p.pop();for(;p.length>1&&p.length<ee;)p.push(...p.map(t=>({...t})));p.push(ge);window.tasks=p;const et=ft?Xt("mileStones"):[{start:10,name:"提测"}];window.mileStones=et;if($t){let t;m.dom.addEventListener("touchstart",function(o){v!=null&&v.resizing||v!=null&&v.dragging||(console.log(o),t=o.touches[0].clientX)}),m.dom.addEventListener("touchmove",function(o){if(v!=null&&v.resizing||v!=null&&v.dragging)return;o.preventDefault();let a=o.touches[0].clientX-t;t=o.touches[0].clientX,S-=Math.floor(a),R(!0,S,0),j.innerText=S})}else m.on("mousewheel",function(t){t.event.preventDefault(),S-=Math.floor(t.event.wheelDeltaX*.01*Gt),R(!0,S,0),j.innerText=S});window.addEventListener("resize",function(){m.resize(),R(!0)});ne(t=>S=t,t=>t,j,R);let pt=!0;function R(t=!1,o=S,a=0){const i=pt;pt&&(pt=!1);const e=Kt-o,n=Math.max(Qt,A+tt)-a;t&&m.clear();const r=m.getWidth(),u=m.getHeight(),f=Math.floor(S/h),s=Math.floor((S+r)/h);let l,c;function z(d){if(v!=null&&v.resizing||v!=null&&v.dragging)return;const L=d.event.zrX-e,C=d.event.zrY-n,x=Math.floor(L/h),w=Math.floor(C/(g+y));if(l!==[x,w].join())if(l=[x,w].join(),w>=0&&w<p.length){if(x>=p[w].start&&x<p[w].start+p[w].duration){c&&m.remove(c);return}const T=new zrender.Group;T.on("click",function(){console.log("dayHoverGroup clicked pos: ",[x,w]);const H=prompt("task name?");if(!H)return;const _=prompt("assign to who?")||Zt;p.splice(w,0,{name:H,start:x,duration:1,resource:_,fillColor:Y()}),F(),R(!0)});const P=new zrender.Rect({shape:{x:e+h*x+5,y:n+(g+y)*w,width:h-10,height:g+y},style:{fill:"transparent",stroke:"gray",lineDash:[5,7]},z:100}),B=new zrender.Rect({shape:{x:e+S,y:n+(g+y)*w,width:h*M,height:g+y},style:{fill:"rgba(221, 221, 221, 0.3)"},z:1}),q=new zrender.Line({shape:{x1:e+h*x+h/2-5,y1:n+(g+y)*w+(g+y)/2,x2:e+h*x+h/2+5,y2:n+(g+y)*w+(g+y)/2},style:{stroke:"gray"},z:100}),k=new zrender.Line({shape:{x1:e+h*x+h/2,y1:n+(g+y)*w+(g+y)/2-5,x2:e+h*x+h/2,y2:n+(g+y)*w+(g+y)/2+5},style:{stroke:"gray"},z:100});T.add(P),T.add(q),T.add(k),T.add(B),c&&m.remove(c),c=T,m.add(T)}else c&&m.remove(c)}wt&&m.off("mousemove",wt),wt=z,m.on("mousemove",z);const M=Math.ceil(r/h),X=new zrender.Rect({shape:{x:e+S,y:n-A,width:M*h,height:A},style:{fill:"rgba(255, 0,0, .2)"}});m.add(X);const $=e,ot=M*h,vt=M+1,Ot=Math.floor(S/h);for(let d=0+Ot,L=0;L<vt;d++,L++){const C=Math.min(p.length,(u-n)/(g+y)),x=$+d*h,w=new zrender.Line({shape:{x1:x,y1:n-A,x2:x,y2:n+(g+y)*C},style:{stroke:"lightgray"}});if(L<vt-1){const T=+new Date("2024-01-01")+d*60*1e3*60*24,P=At(T);if(P.isHoliday)try{Rt([[e+d*h,n],[e+d*h+h,n],[e+d*h+h,n+(g+y)*C],[e+d*h,n+(g+y)*C]],10,45).forEach(I=>{const[rt,Z]=I[0],[K,at]=I[1],it=new zrender.Line({shape:{x1:rt,y1:Z,x2:K,y2:at},style:{stroke:"rgba(221, 221, 221, 0.7)"}});m.add(it)})}catch(O){console.log(O)}const B=new zrender.Text({style:{text:P.dateString,x,y:n-A},z:1}),[q,{flag:k}]=re(m,x,W,n,A);B.on("click",function(){console.log("date text click",d);const O=et.findIndex(I=>I.start===d);if(O===-1){if(confirm("Do you want to CREATE a milestone here?")){const I=prompt("mileStone name?");et.push({start:d,name:I}),F()}}else confirm("Do you want to DELETE the milestone here?")&&(et.splice(O,1),F());R(!0)}),B.on("mouseover",function(O){this.attr({style:{opacity:0}}),q.show()}),B.on("mouseout",function(O){this.attr({style:{opacity:1}}),q.hide()});const{width:H,height:_}=B.getBoundingRect();B.attr({style:{x:x-H/2+W,y:n-A-_/2+A/2}}),m.add(B)}m.add(w)}p.length+1;for(let d=0;d<1;d++){const L=n+d*(g+y),C=new zrender.Line({shape:{x1:e,y1:L,x2:ot+e,y2:L},style:{stroke:"lightgray"}});m.add(C)}fe(m,e,n,A,g,y,Ht),et.forEach(function(d){const L=new zrender.Rect({shape:{x:e+d.start*h-1,y:n-A,width:2,height:p.length*(g+y)+A},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),C=new zrender.Rect({shape:{x:e+d.start*h-1,y:n-A-tt,width:10,height:tt},style:{fill:"rgba(255, 0, 0, 1)"},z:1}),x=new zrender.Text({style:{x:e+d.start*h-1+10,y:n-A-tt,text:d.name||"里程碑",fill:"white",lineHeight:tt,fontSize:12},z:1}),w=x.getBoundingRect();C.attr({shape:{width:w.width+10*2}}),m.add(L),m.add(C),m.add(x)});let gt=0;p.forEach(function(d,L){if(!(d!=null&&d.name)||L>Math.floor((u-n)/(g+y)))return;const C=d.start<=f,x=d.start+d.duration>s;gt++;const w=e+d.start*h,V=n+(g+y)*L,T=d.duration*h,P={width:T,height:g},B=he(w,V,d,P,C,f,function(){S=(d.start-3)*h,j.innerText=S,R(!0)}),q=ue(w,V,d,h,S,r,P,x,s,function(){S=(d.start+d.duration+3)*h-r,j.innerText=S,R(!0)});if(B&&m.add(B),q&&m.add(q),d.start>s||d.start+d.duration<f)return;const k=new zrender.Group({x:w,y:V,draggable:!$t}),H=new zrender.Rect({shape:{x:0,y:0,width:T,height:g,r:6},style:{fill:d.fillColor},cursor:"move"});k.add(H),k.index=L;const _=6,O=H.getBoundingRect(),I=ae(_,O,P,R);I.taskBar=H,k.add(I);const rt=ie(_,O,P,R);rt.taskBar=H,k.add(rt),k.on("mouseover",function(){this.dragging||H.attr("style",{fill:zrender.color.lift(d.fillColor,.3)})}),k.on("mouseout",function(){this.dragging||this.resizing||H.attr("style",{fill:d.fillColor})});const Z=new zrender.Text({style:{text:d.name,x:lt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),K=new zrender.Text({style:{text:`${ce(d,te)}天`,x:T-lt,y:g/2-12/2,textFill:"white",textAlign:"left",textVerticalAlign:"middle",fill:"white"},cursor:"move"}),{width:at}=K.getBoundingRect();K.attr({style:{x:T-at-lt}});const it=new zrender.Text({style:{text:"Assigned to: "+d.resource,x:0+T+5,y:g/2+0-12/2,textFill:"black"},cursor:"normal"});Z.getBoundingRect().width+at+lt*2>T&&(it.attr({style:{text:d.name}}),Z.hide()),k.add(Z),k.add(K),k.add(it);let bt=0,Lt=null,mt=null;k.on("dragstart",function(D){this.resizing||(bt=D.event.zrX,U(this))}),k.on("drag",function(D){if(this.resizing)return;const st=D.event.zrY-n,Q=Math.floor(st/(g+y));if(Lt!==Q){Lt=Q,m.remove(mt);const J=de(e,n,S,M,Q);mt=J,J&&m.add(J),m.refresh()}}),k.on("dragend",function(D){if(console.log("dragend"),this.resizing){this.resizing=!1;return}const st=D.event.zrX-bt,Q=st<0?-1:1,J=Math.abs(st),Pt=J%h,kt=Q*(Math.floor(J/h)+Math.floor(Pt/W)),It=D.event.zrY-n,G=Math.floor(It/(g+y)),Ft=G-L;d.start+=kt,mt&&G!==L&&(p.splice(L,1),p.splice(G>L?G-1:G,0,{...d})),(kt||Ft)&&F(),U(null),R(!0)}),k.eachChild(function(D){D.attr({z:10})}),k.on("dblclick",function(){N.show();const D=document.querySelector("#current-task");D.value=JSON.stringify(p[this.index],null,2),D.dataset.index=this.index}),m.add(k)}),i&&gt===0&&p.length>0&&(console.log(p[0].start),S+=(p[0].start-f-1)*h,j.innerText,R(!0)),ut&&console.log({drawTaskBar:gt})}window.redrawChart=R;St?(document.title+=" (Remote)",Yt(m,R)):(nt&&zt("tasks",p.filter(t=>t.fillColor===nt)),R());
